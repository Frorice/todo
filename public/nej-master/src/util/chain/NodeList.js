NEJ.define(["base/event","base/element","base/util","base/chain","util/query/query"],function(t,e,n,r,i){function o(t,e){this.length=0,this._signs={},this._context=e||s,t&&("string"==typeof t?(e&&e instanceof o&&(e=e[0]),"string"==typeof e&&(e=g(e)[0]),this._$add(i._$all(t,e))):(t instanceof o||p(t)||t.length)&&this._$add(t))}var a=[].slice,s=document,u="documentElement",c=s[u],f=s.createElement("div"),l=null==f.textContent?"innerText":"textContent",h=function(t,e,n){return n=n||{},(null==this[t]||n.override)&&(this[t]=e),this},_=function(t,e,n){for(;e&&e!==n;){if(nes.matches(e,t))return e;e=e.parentNode}},d=function(n,r,i){return n===i||"undefined"===n||n===this||n===e||n===t},p=function(t){if(!t)return!1;var e=t.nodeType;return 1===e||9===e||11===e||t.window===t},$=function(t){var e=t.prototype,n={};return{extend:function(t,r){return n[t]=e[t],e[t]=r,this},reset:function(){for(var t in n)n.hasOwnProperty(t)&&(void 0===n[t]?delete e[t]:e[t]=n[t])}}},v=$(Function);v.extend("autoSet",function(){var t=this;return function(e,r){if(n._$isObject(e)){var i=a.call(arguments,1);for(var o in e)t.apply(this,[o,e[o]].concat(i));return this}return t.apply(this,arguments)}}).extend("splitProcess",function(t){var e=this;return function(r){if(n._$isArray(r)){var i,o=a.call(arguments,1),s=r.length;t&&(i={});for(var u=0;u<s;u++){var c=r[u],f=e.apply(this,[c].concat(o));t&&"string"==typeof c&&(i[c]=f)}return t?i:this}return e.apply(this,arguments)}}),h=h.autoSet();var g=function(t,e){if(g._$implement(r._$dump(),{statics:!0}),r._$clear(),"string"==typeof t&&0==t.trim().indexOf("<")){var n=document.createElement("div");n.innerHTML=t;var i=g(n.childNodes);return i}return new o(t,e)};g._$extend=h._$bind(g),g._$extend({_$signal:"_uid",_$instances:{},_$handlers:[],_$fragment:function(){},_$implement:function(t,e,n){n=n||{},h.call(o.prototype,t,n.statics?this._transport(e):e)}.autoSet(),_transport:function(t){return function(){var e=a.call(arguments);e.unshift(this[0]);var n=t.apply(this,e);return d.call(this,n)?(this._$forEach(function(n,r){0!==r&&(e[0]=n,t.apply(this,e))}),this):n}},_merge:function(t,e,n){for(var r=t.length||0,i=0;void 0!==e[i];){var o=e[i++];n&&!n.call(t,o)||(t[r++]=o)}return t.length=r,t},_toArray:function(t){return g._merge([],t)},_contains:c.contains?function(t,e){return t===e||(9==t.nodeType?t[u]:t).contains(e)}:c.compareDocumentPosition?function(t,e){return e&&!!(16&t.compareDocumentPosition(e))}:function(t,e){for(;e=e.parentNode;)if(e===t)return!0;return!1},_$cloneNode:function(t,e){e=!!e;var n,r,i=t.cloneNode(e);for(e?(r=nes.all("*",t),r.push(t),n=nes.all("*",i),n.push(i)):(r=[t],n=[i]),_i=n.length;_i--;)E.fixture.clone(n[_i],r[_i]);return i},_delegateHandlers:{},_cleanSelector:nes._cleanSelector,_$uniqueSort:nes._uniqueSort,_$matches:nes.matches,_$fn:o.prototype,_$uid:nes._getUid});var m=/^(?:click|dblclick|contextmenu|DOMMouseScroll|mouse(?:\w+))$/,E={insertor:{top:function(t,e){t.insertBefore(e,t.firstChild)},bottom:function(t,e){t.appendChild(e)},before:function(t,e){var n=t.parentNode;n&&n.insertBefore(e,t)},after:function(t,e){var n=t.parentNode;n&&n.insertBefore(e,t.nextSibling)}},fixProps:{input:"checked",option:"selected",textarea:"value",script:"text"},fixture:{clone:function(t,e){var n;1===t.nodeType&&(t.clearAttributes&&(t.clearAttributes(),t.mergeAttributes(e)),n=t.nodeName.toLowerCase(),(_prop=E.fixProps[n])&&(t[_prop]=e[_prop]),t.removeAttribute(g._$signal),t.removeAttribute("id"))},event:function(e){var n=e.type,r=e.button;if(e.__fixed=!0,e.target=e.target||e.srcElement||document,e.metaKey=!!e.metaKey,3===e.target.nodeType&&(e.target=e.target.parentNode),m.test(n)&&(e.pageX=t._$pageX(e),e.pageY=t._$pageY(e),"mouseover"===n||"mouseout"===n)){for(var i=e.relatedTarget||e[("mouseover"==n?"from":"to")+"Element"];i&&3==i.nodeType;)i=i.parentNode;e.relatedTarget=i}e.which=null!=e.charCode?e.charCode:e.keyCode,e.which||void 0===r||(e.which=1&r?1:2&r?3:4&r?2:0),e.preventDefault||(e.preventDefault=function(){return this.returnValue=!1,this}),e.stopPropagation||(e.stopPropagation=function(){return this.cancelBubble=!0,this})}}},y=function(t){var e=g._$matches;return function(n,r){var i=g([]);return"boolean"==typeof n&&(r=n,n=null),this._$forEach(function(o){for(var a=o[t];a&&(1!==a.nodeType||n&&!e(a,n)||(i._$add(a),r));)a=a[t]}),i}};return g._$implement({_$style:function(t,n){if(!t)throw Error("缺少css样式名");return void 0===n?e._$getStyle(this[0],t):this._$forEach(function(r){e._$setStyle(r,t,n)})}.splitProcess(!0).autoSet(),_$attr:function(t,n){if(!t)throw Error("缺少属性名");return void 0===n?e._$attr(this[0],t):this._$forEach(function(r){e._$attr(r,t,n)})}.splitProcess(!0).autoSet(),_$forEach:function(t){return n._$forEach(this,t),this},_$filter:function(t){var e=[],n="string"==typeof t;return this._$forEach(function(r,i){var o=n?g._$matches(r,t):t.call(this,r,i);o&&e.push(r)}),g(e)},_$map:function(t){var e=[],n=!1;return this._$forEach(function(r,i){var o=t.call(this,r,i);p(o)||(n=!0),e.push(o)}),n?e:g([])._$add(e)},_$sort:function(){var t=this._$get();return g._$uniqueSort(t),g(t)},_$add:function(t){if(t)return(t.tagName||"number"!=typeof t.length||t===window)&&(t=[t]),g._merge(this,t,function(t){if(!p(t))return!1;var e=g._$uid(t);return!this._signs[e]&&(this._signs[e]=1,!0)}),this},_$get:function(t,e){return"number"!=typeof t?g._toArray(this):e?g(this[t]):this[t]},_$last:function(t){return t?g(this[this.length-1]):this[this.length-1]},_$first:function(t){return t?g(this[0]):this[0]},_$matches:function(t){return g._$matches(this[0],t)},_$parent:y("parentNode"),_$prev:y("previousSibling"),_$next:y("nextSibling"),_$children:function(t,e){var n=g([]);return"boolean"==typeof t&&(e=t,t=null),this._$forEach(function(r){var o=e?i._$all(t||"*",r):t?g(r.childNodes)._$filter(t):g(r.childNodes);n._$add(o)}),n},_$siblings:function(t){return this._$prev(t,!0)._$add(this._$next(t,!0))},_$insert:function(t,e){e=e&&e.toLowerCase()||"bottom",E.insertor[e]||(e="bottom");var n=g(t)[0],r=E.insertor[e];if(!n)throw Error("The Element to be inserted is not exist");return this._$forEach(function(t,e){r(t,0===e?n:g._$cloneNode(n,!0))})},_$insert2:function(t,e){return g(t)._$insert(this,e),this},_$clone:function(t){return this._$map(function(e){return g._$cloneNode(e,t)})},_$text:function(t){if(void 0===t){if(!this[0])throw Error("内部节点为空，无法完成get操作");return this[0][l]}return this._$forEach(function(e){e[l]=t})},_$html:function(t){if(void 0===t){if(!this[0])throw Error("内部节点为空，无法完成get操作");return this[0].innerHTML}return this._$forEach(function(e){e.innerHTML=t})},_$val:function(t){if(void 0===t){if(!this[0])throw Error("内部节点为空，无法完成get操作");return this[0].value}return this._$forEach(function(e){e.value=t})},_delegate:function(e,n,r){return n=g._cleanSelector(n),this._$forEach(function(i){var o=g._$uid(i),a=g._delegateHandlers[o]||(g._delegateHandlers[o]={}),s=a[e]||(a[e]={}),u=s[n]||(s[n]=[]),c=function(t){var e;(e=_(n,t.target||t.srcElement,i))&&r.apply(e,arguments)};c._raw=r,u.push(c),t._$addEvent(i,e,c)})},_undelegate:function(e,n,r){return n=g._cleanSelector(n),this._$forEach(function(i){var o,a,s,u=g._$uid(i);if((o=g._delegateHandlers[u])&&(a=o[e])&&(s=a[n])){for(var c=s.length;c--;){var f=s[c];r&&f._raw!==r||(t._$delEvent(i,e,f),s.splice(c,1))}s.length||delete a[n]}})},_$on:function(e,n,r){if(void 0===e)throw Error("缺少事件名参数");"function"==typeof n&&(r=n,n=null);var i=e.indexOf(" ");if(~i&&(n=e.slice(i+1),e=e.slice(0,i)),!r)throw Error("缺少回调函数");var o=r,r=function(t){E.fixture.event(t),o.apply(this,arguments)};return o.real=r,n?this._delegate(e,n,r):this._$forEach(function(n){t._$addEvent(n,e,r)})}.splitProcess().autoSet(),_$off:function(e,n,r){"function"==typeof n&&(r=n,n=null);var i;return e&&~(i=e.indexOf(" "))&&(n=e.slice(i+1),e=e.slice(0,i)),r&&(r=r.real||r),n?this._undelegate(e,n,r):this._$forEach(function(n){var i,o=g._$uid(n),a=g._delegateHandlers[o];e?(a&&(i=a[e]),r?t._$delEvent(n,e,r):(i&&delete a[e],t._$clearEvent(n,e))):(a&&delete g._delegateHandlers[o],t._$clearEvent(n,e))})}.splitProcess().autoSet(),_$trigger:function(e,n){if("string"!=typeof e)throw Error("事件类型参数错误");return this._$forEach(function(r){t._$dispatchEvent(r,e,n)}),this}.splitProcess().autoSet(),splice:function(){throw Error("don't use the NodeList#splice")}}),v.reset(),CMPT&&(nej.$=g),g});