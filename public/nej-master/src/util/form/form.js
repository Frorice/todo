NEJ.define(["base/global","base/klass","base/element","base/event","base/util","util/event","util/focus/focus","util/counter/counter","util/placeholder/placeholder"],function(t,e,i,_,n,s,a,r,o,h,u,d,l,c){return h._$$WebForm=e._$klass(),c=h._$$WebForm._$extend(s._$$EventTarget),c.__init=function(){this.__super(),this.__wopt={tp:{nid:"js-nej-tp"},ok:{nid:"js-nej-ok"},er:{nid:"js-nej-er"}}},c.__reset=function(t){this.__super(t),this.__form=document.forms[t.form]||i._$get(t.form),this.__doInitDomEvent([[this.__form,"enter",this._$dispatchEvent._$bind(this,"onenter")]]),this.__message=t.message||{},this.__message.pass=this.__message.pass||"&nbsp;";var e=this.__dataset(this.__form,"focusMode",1);isNaN(e)||(this.__fopt={mode:e,clazz:t.focus}),this.__holder=t.holder,this.__wopt.tp.clazz="js-mhd "+(t.tip||"js-tip"),this.__wopt.ok.clazz="js-mhd "+(t.pass||"js-pass"),this.__wopt.er.clazz="js-mhd "+(t.error||"js-error"),this.__invalid=t.invalid||"js-invalid",this.__doInitValidRule(t),this._$refresh(),this.__fnode&&this.__fnode.focus()},c.__destroy=function(){this.__super(),this._$reset(),delete this.__message,delete this.__fnode,delete this.__vinfo,delete this.__xattr,delete this.__form,delete this.__treg,delete this.__vfun},c.__dataset=function(t,e,_){var n=i._$dataset(t,e);switch(_){case 1:return parseInt(n,10);case 2:return"true"==(n||"").toLowerCase();case 3:return this.__doParseDate(n)}return n},c.__number=function(t,e,i){return"date"==e?this.__doParseDate(t,i):parseInt(t,10)},c.__isValidElement=function(){var t=/^button|submit|reset|image|hidden|file$/i;return function(e){e=this._$get(e)||e;e.type;return!!e.name&&!t.test(e.type||"")}}(),c.__isValueElement=function(){var t=/^hidden$/i;return function(e){if(this.__isValidElement(e))return!0;e=this._$get(e)||e;var i=e.type||"";return t.test(i)}}(),c.__doParseDate=function(){var t=/[:\.]/;return function(e,i){if("now"==(e||"").toLowerCase())return+new Date;var _=n._$var2date(e);if(_&&!t.test(e)){var s=(i||"").split(t);_.setHours(parseInt(s[0],10)||0,parseInt(s[1],10)||0,parseInt(s[2],10)||0,parseInt(s[3],10)||0)}return+_}}(),c.__doCheckString=function(t,e){var i=this.__vfun[e],_=this.__dataset(t,e);_&&i&&(this.__doPushValidRule(t,i),this.__doSaveValidInfo(t,e,_))},c.__doCheckPattern=function(t,e){try{var i=this.__dataset(t,e);if(!i)return;var _=new RegExp(i);this.__doSaveValidInfo(t,e,_),this.__doPushValidRule(t,this.__vfun[e])}catch(t){}},c.__doCheckBoolean=function(t,e){var i=this.__vfun[e];i&&this.__dataset(t,e,2)&&this.__doPushValidRule(t,i)},c.__doCheckNumber=function(t,e,i){i=parseInt(i,10),isNaN(i)||(this.__doSaveValidInfo(t,e,i),this.__doPushValidRule(t,this.__vfun[e]))},c.__doCheckDSNumber=function(t,e){this.__doCheckNumber(t,e,this.__dataset(t,e))},c.__doCheckATNumber=function(t,e){this.__doCheckNumber(t,e,i._$attr(t,e))},c.__doCheckTPNumber=function(t,e,i){var _=this.__number(this.__dataset(t,e),this.__dataset(t,"type"));this.__doCheckNumber(t,e,_)},c.__doCheckCustomAttr=function(t){n._$loop(this.__xattr,function(e,_){var n=i._$dataset(t,_);null!=n&&(this.__doSaveValidInfo(t,_,n),this.__doPushValidRule(t,this.__vfun[_]))},this)},c.__doPrepareElement=function(){var t=/^input|textarea$/i,e=function(t){this._$showTip(_._$getElement(t))},n=function(t){var e=_._$getElement(t);this.__dataset(e,"ignore",2)||this.__doCheckValidity(e)};return function(_){this.__dataset(_,"autoFocus",2)&&(this.__fnode=_);var s=i._$attr(_,"placeholder");s&&"null"!=s&&o._$placeholder(_,this.__holder),this.__fopt&&t.test(_.tagName)&&a._$focus(_,this.__fopt);var h=i._$id(_);this.__doCheckBoolean(h,"required"),this.__doCheckString(h,"type"),this.__doCheckPattern(h,"pattern"),this.__doCheckATNumber(h,"maxlength"),this.__doCheckATNumber(h,"minlength"),this.__doCheckDSNumber(h,"maxLength"),this.__doCheckDSNumber(h,"minLength"),this.__doCheckTPNumber(h,"min"),this.__doCheckTPNumber(h,"max"),this.__doCheckCustomAttr(h);var d=i._$dataset(h,"time");d&&this.__doSaveValidInfo(h,"time",d);var l=_.name;this.__message[l+"-tip"]=this.__dataset(_,"tip"),this.__message[l+"-error"]=this.__dataset(_,"message"),this._$showTip(_);var c=this.__vinfo[h],f=(c||u).data||u,m=this.__dataset(_,"counter",2);m&&(f.maxlength||f.maxLength)&&r._$counter(h,{nid:this.__wopt.tp.nid,clazz:"js-counter"}),c&&t.test(_.tagName)?this.__doInitDomEvent([[_,"focus",e._$bind(this)],[_,"blur",n._$bind(this)]]):this.__dataset(_,"focus",2)&&this.__doInitDomEvent([[_,"focus",e._$bind(this)]])}}(),c.__doInitValidRule=function(){var e={number:/^[\d]+$/i,url:/^[a-z]+:\/\/(?:[\w-]+\.)+[a-z]{2,6}.*$/i,email:/^[\w-\.]+@(?:[\w-]+\.)+[a-z]{2,6}$/i,date:function(t,e){var i=this.__dataset(e,"format")||"yyyy-MM-dd";return!t||!isNaN(this.__doParseDate(t))&&n._$format(this.__doParseDate(t),i)==t}},i={required:function(t){var e=t.type,i=!t.value,_=("checkbox"==e||"radio"==e)&&!t.checked;if(_||i)return-1},type:function(t,e){var i=this.__treg[e.type],_=t.value.trim(),s=!!i.test&&!i.test(_),a=n._$isFunction(i)&&!i.call(this,_,t);if(s||a)return-2},pattern:function(t,e){if(!e.pattern.test(t.value))return-3},maxlength:function(t,e){if(t.value.length>e.maxlength)return-4},minlength:function(t,e){if(t.value.length<e.minlength)return-5},maxLength:function(t,e){if(n._$length(t.value)>e.maxLength)return-4},minLength:function(t,e){if(n._$length(t.value)<e.minLength)return-5},min:function(t,e){var i=this.__number(t.value,e.type,e.time);if(isNaN(i)||i<e.min)return-6},max:function(t,e){var i=this.__number(t.value,e.type,e.time);if(isNaN(i)||i>e.max)return-7}},_=function(t,e,i,_){var s=t[i];return n._$isFunction(e)&&n._$isFunction(s)?void(t[i]=s._$aop(e)):void(t[i]=e)};return function(s){this.__treg=t.X({},e),n._$loop(s.type,_._$bind(null,this.__treg)),this.__vfun=t.X({},i),this.__xattr=s.attr,n._$loop(this.__xattr,_._$bind(null,this.__vfun))}}(),c.__doPushValidRule=function(t,e){if(n._$isFunction(e)){var i=this.__vinfo[t];i&&i.func||(i=i||{},i.func=[],this.__vinfo[t]=i),i.func.push(e)}},c.__doSaveValidInfo=function(t,e,i){if(e){var _=this.__vinfo[t];_&&_.data||(_=_||{},_.data={},this.__vinfo[t]=_),_.data[e]=i}},c.__doCheckValidity=function(t){if(t=this._$get(t)||t,!t)return!0;var e=this.__vinfo[i._$id(t)];if(!e&&this.__isValidElement(t)&&(this.__doPrepareElement(t),e=this.__vinfo[i._$id(t)]),!e)return!0;var _;if(n._$forIn(e.func,function(i){return _=i.call(this,t,e.data),null!=_},this),null==_){var s={target:t,form:this.__form};this._$dispatchEvent("oncheck",s),_=s.value}var s={target:t,form:this.__form};return null!=_?(n._$isObject(_)?n._$merge(s,_):s.code=_,this._$dispatchEvent("oninvalid",s),s.stopped||this._$showMsgError(t,s.value||this.__message[t.name+_])):(this._$dispatchEvent("onvalid",s),s.stopped||this._$showMsgPass(t,s.value)),null==_},c.__doShowMessage=function(){var t={tp:"tip",ok:"pass",er:"error"},e=function(t,e){return t==e?"block":"none"},_=function(t,e,_){var n=s.call(this,t,e);return!n&&_&&(n=i._$wrapInline(t,this.__wopt[e])),n},s=function(e,_){var n=i._$get(e.name+"-"+t[_]);return n||(n=i._$getByClassName(e.parentNode,this.__wopt[_].nid)[0]),n};return function(t,a,r){if(t=this._$get(t)||t){"er"==r?i._$addClassName(t,this.__invalid):i._$delClassName(t,this.__invalid);var o=_.call(this,t,r,a);o&&a&&(o.innerHTML=a),n._$loop(this.__wopt,function(_,n){i._$setStyle(s.call(this,t,n),"display",e(r,n))},this)}}}(),c._$showTip=function(t,e){this.__doShowMessage(t,e||this.__message[t.name+"-tip"],"tp")},c._$showMsgPass=function(t,e){this.__doShowMessage(t,e||this.__message[t.name+"-pass"]||this.__message.pass,"ok")},c._$showMsgError=function(t,e){this.__doShowMessage(t,e||this.__message[t.name+"-error"],"er")},c._$setValue=function(){var t=/^(?:radio|checkbox)$/i,e=function(t){return null==t?"":t},i=function(t,i){if(i.multiple){var _;n._$isArray(t)?_=n._$array2object(t):_[t]=t,n._$forEach(i.options,function(t){t.selected=null!=_[t.value]})}else i.value=e(t)},_=function(_,n){t.test(n.type||"")?n.checked=_==n.value:"SELECT"==n.tagName?i(_,n):n.value=e(_)};return function(t,e){var i=this._$get(t);i&&("SELECT"!=i.tagName&&i.length?n._$forEach(i,_._$bind(null,e)):_(e,i))}}(),c._$get=function(t){return this.__form.elements[t]},c._$form=function(){return this.__form},c._$data=function(){var t=/^radio|checkbox$/i,e=/^number|date$/,_=function(t){if("SELECT"==t.tagName&&t.multiple){var e=[];return n._$forEach(t.options,function(t){t.selected&&e.push(t.value)}),e.length>0?e:""}return t.value},s=function(s,a){var r=a.name,o=_(a),h=s[r],u=this.__dataset(a,"type"),d=i._$dataset(a,"time");e.test(u)&&(n._$isArray(o)?n._$forEach(o,function(t,e,i){i[e]=this.__number(t,u,d)},this):o=this.__number(o,u,d)),(!t.test(a.type)||a.checked||(o=this.__dataset(a,"value")))&&(h?(n._$isArray(h)||(h=[h],s[r]=h),h.push(o)):s[r]=o)};return function(){var t={};return n._$forEach(this.__form.elements,function(e){this.__isValueElement(e)&&s.call(this,t,e)},this),t}}(),c._$reset=function(){var t=function(t){this.__isValidElement(t)&&this._$showTip(t)};return function(){this.__form.reset(),n._$forEach(this.__form.elements,t,this)}}(),c._$submit=function(){this.__form.submit()},c._$refresh=function(){var t=function(t){this.__isValidElement(t)&&this.__doPrepareElement(t)};return function(){this.__vinfo={},n._$forEach(this.__form.elements,t,this)}}(),c._$checkValidity=function(t){if(t=this._$get(t)||t)return this.__doCheckValidity(t);var e=!0;return n._$forEach(this.__form.elements,function(t){var i=this._$checkValidity(t);e=e&&i},this),e},CMPT&&t.copy(t.P("nej.ut"),h),h});