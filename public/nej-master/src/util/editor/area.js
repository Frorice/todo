NEJ.define(["base/global","base/klass","base/element","base/event","base/util","{platform}editor.js","util/event","base/platform"],function(t,e,n,o,i,_,s,c,r,h,a,u){var l;return r._$$EditorArea=e._$klass(),l=r._$$EditorArea._$extend(s._$$EventTarget),l.__init=function(){this.__fopt={visible:!0,onload:this.__onIFrameLoaded._$bind(this)},this.__super()},l.__reset=function(){var t='<head><base href="#<BSUL>"/><style>html,body{margin:0;padding:0;border:0;cursor:text;font-size:14px;font-family:Arial;word-wrap:break-word;height:100%;} html{overflow:hidden;}body{overflow:auto;}#<UDCS></style></head><body contenteditable="true"></body>';return function(e){this.__super(e),this.__focus=e.focus,this.__content=t.replace("#<UDCS>",e.style||"").replace("#<BSUL>",e.base||location.href),this.__initcnt=e.content||"",this.__fopt.parent=n._$get(e.parent)||document.body,this.__iframe=n._$createXFrame(this.__fopt)}}(),l.__destroy=function(){this.__super(),_.__clearRange(this._$getDocument()),delete this.__content,delete this.__fopt.parent,delete this.__initcnt,this.__iframe=n._$remove(this.__iframe)},l.__doSaveRange=function(){_.__saveRange(this._$getDocument())},l.__onIFrameLoaded=function(t){var e=this._$getDocument();e.open(),e.write(this.__content),location.hostname!=document.domain&&(e.domain=document.domain),e.close(),_.__supportSelectionChange(e.body),this.__doInitDomEvent([[e,"click",this.__onDocumentClick._$bind(this)],[e,"selectionchange",this.__onSelectionChange._$bind(this)],[e,"beforedeactivate",this.__doSaveRange._$bind(this)],[e,"keydown",this.__onInputCheck._$bind(this)],[e,"mouseup",this.__onInputCheck._$bind(this)],[e,"paste",this.__onInputCheck._$bind(this)],[e,"drop",this.__onInputCheck._$bind(this)]]),this.__initcnt&&this._$setContent(this.__initcnt),this.__focus&&(this._$focus(),delete this.__focus)},l.__onDocumentClick=function(t){o._$dispatchEvent(document,"click")},l.__onSelectionChange=function(){this._$dispatchEvent("onselectionchange")},l.__onInputCheck=function(){this.__timer&&window.clearTimeout(this.__timer),this.__timer=window.setTimeout(this.__doCompareContent._$bind(this),100)},l.__doCompareContent=function(){var t=this._$getDocument();if(t){var e=t.body.innerHTML;this.__initcnt!=e&&(this.__initcnt=e,this._$dispatchEvent("oninput",{cont:this._$getContent(),txt:this._$getTextContent()}))}},l.__doRemoveStyle=function(){var t=/style="[^"]*"/gi,e=/style='[^']*'/gi,n=/style=[^>\s]*/gi,o=/class="[^"]*"/gi,i=/class='[^']*'/gi,_=/class=[^>\s]*/gi;return function(s){return s.replace(t,"").replace(e,"").replace(n,"").replace(o,"").replace(i,"").replace(_,"")}}(),l.__doRemoveId=function(){var t=/id="[^"]*"/gi,e=/id='[^']*'/gi,n=/id=[^>\s]*/gi;return function(o){return o.replace(t,"").replace(e,"").replace(n,"")}}(),l._$focus=function(t){var e=this._$getDocument();e&&(_.__focusRange(e.body),_.__moveCursorPosition(e.body,parseInt(t)||0),this.__onSelectionChange())},l._$getDocument=function(){return this.__iframe.contentWindow.document},l._$getContent=function(t){var e,n,o,s=this._$getDocument();return i._$isObject(t)&&(o=t.keepClass||!1,n=t.keepStyle||!1,e=t.noId),_html=_.__filterContent(s?s.body.innerHTML:"",o),n||(_html=_.__filterContentStyle(_html)),e&&(_html=this.__doRemoveId(_html)),_.__filterWordContent?_.__filterWordContent(_html):_html},l._$getTextContent=function(){var t=this._$getDocument(),e=t.body.innerText||t.body.textContent;return t?e:""},l._$setContentNoStyle=function(){var t=this._$getSelectNode();if(t){var e=this._$getDocument(),n=t.outerHTML,o=e?e.body.outerHTML:"";o=o.replace(n,this.__doRemoveStyle(n)),o=_.__filterContent(o);var i=_.__filterWordContent?_.__filterWordContent(o):o;this._$setContent(i)}},l._$setContent=function(t){var e=this._$getDocument();e&&(e.body.innerHTML=t,this.__onInputCheck())},l._$execCommand=function(t,e,n){var o=this._$getDocument();o&&(_.__execCommand(o,"styleWithCSS",!1),_.__execCommand(o,t,e),"inserthtml"==t?this._$focus(3):this._$focus(2),this.__onInputCheck())},l._$queryCommand=function(t,e){try{var n=this._$getDocument();return n?n["queryCommand"+e](t):null}catch(t){return null}},l._$getSelectText=function(){return this._$focus(2),_.__getSelectText(this._$getDocument())},l._$getSelectHtml=function(){return this._$focus(2),_.__getSelectHtml(this._$getDocument())},l._$getSelectNode=function(){return this._$focus(2),_.__getSelectNode(this._$getDocument())},l._$getAreaBox=function(){var t=this._$getDocument();return t?n._$getPageBox(t):null},CMPT&&t.copy(t.P("nej.ut"),r),r});