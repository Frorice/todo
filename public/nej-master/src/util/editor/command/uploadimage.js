NEJ.define(["base/global","base/klass","base/util","util/editor/command/card","ui/editor/command/uploadimage"],function(a,o,d,e,i,r,t,_,s){var n;return r._$$UploadImage=o._$klass(),n=r._$$UploadImage._$extend(e._$$CardCommand),r._$$UploadImage.command="uploadImage",n.__doShowCard=function(){this.__onShowCard()},n.__onShowCard=function(){this.__uploadCard||(this.__uploadCard=i._$$UploadImageCard._$allocate({onchange:this.__onChange._$bind(this)})),this.__uploadCard._$show()},n.__onChange=function(a,o){this.__editor._$focus(2);var e,i=0;if(o.ourl&&o.ourl.indexOf(".gif")>0){if(e=o.ourl,o.photoGarbageIds){var r=o.photoGarbageIds.split(",");d._$forEach(r,function(a,o){a.search("ourl")>=0&&(i=a.split(":")[1])},this)}}else if(e=o.userDef2Url,o.photoGarbageIds){var r=o.photoGarbageIds.split(",");d._$forEach(r,function(a,o){a.search("userdef2url")>=0&&(i=a.split(":")[1])},this)}var t='<img style="max-width:520px;" src='+e+" id="+i+" />";this.__editor._$execCommand(a,t)},r._$$UploadImage._$regist(),CMPT&&a.copy(a.P("nej.ut.cmd"),r),r});