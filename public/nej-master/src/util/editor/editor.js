NEJ.define(["base/global","base/klass","base/util","util/event","util/editor/area","util/editor/toolbar","util/editor/command"],function(t,_,e,o,n,i,a,r,s,c,l){var $;return r._$$Editor=_._$klass(),$=r._$$Editor._$extend(o._$$EventTarget),$.__init=function(){this.__copt={},this.__impl={},this.__super()},$.__reset=function(){var t=function(){this._$registCommand(a._$$EditorCommand._$getImpl(arguments[1]))};return function(_){this.__super(_);var o=_.toolbar,a=o instanceof i._$$EditorToolbar;a?this.__copt.toolbar=o:o=null,o&&(o._$setEvent("oncommand",this.__onCommand._$bind(this)),e._$forIn(o._$getCommandList(),t,this));var r=_.area,a=r instanceof n._$$EditorArea;a?this.__copt.area=r:r=null,r&&r._$setEvent("onselectionchange",this.__onSelectionChange._$bind(this))}}(),$.__destroy=function(){var t=function(t,_,e){t instanceof a._$$EditorCommand&&t._$recycle(),delete e[_]};return function(){this.__super(),this.__copt.area&&(this.__copt.area._$recycle(),delete this.__copt.area),this.__copt.toolbar&&(this.__copt.toolbar._$recycle(),delete this.__copt.toolbar),e._$forIn(this.__impl,t)}}(),$.__getCommandImpl=function(t){var _=this.__impl[t];return _?(_ instanceof a._$$EditorCommand||(_=_._$allocate(this.__copt),this.__impl[t]=_),_):null},$.__onCommand=function(t){this.__getCommandImpl(t.name)._$execute({target:t.node}),this.__copt.area._$focus(2)},$.__onSelectionChange=function(){var t=function(t,_){var e=this.__getCommandImpl(_);if(e){var o=this.__copt.toolbar,n=e._$queryState();null!=n&&o._$select(_,n);var n=e._$queryEnabled();null!=n&&o._$disable(_,!n),e._$queryValue(t)}};return function(){var _=this.__copt.toolbar;_&&e._$forIn(_._$getCommandList(),t,this)}}(),$._$registCommand=function(t){if(!e._$isArray(t)){var _=(t||s).command;return void(_&&(this.__impl[_]=t))}e._$forEach(t,this._$registCommand,this)},$._$setContent=function(t){this.__copt.area&&this.__copt.area._$setContent(t)},$._$getContent=function(t){return this.__copt.area?this.__copt.area._$getContent(t):""},$._$getTextContent=function(){return this.__copt.area?this.__copt.area._$getTextContent():""},$._$getArea=function(){return this.__copt.area},$._$getToolbar=function(){return this.__copt.toolbar},CMPT&&t.copy(t.P("nej.ut"),r),r});