NEJ.define(["base/global","base/klass","base/event","base/element","base/util","util/event","util/dragger/dragger"],function(t,i,_,h,e,s,o,a,n,d,r,l){return a._$$Resizable=i._$klass(),l=a._$$Resizable._$extend(s._$$EventTarget),l.__reset=function(t){this.__super(t);var i=t.min||n;if(this.__body=h._$get(t.body),this.__sbody=h._$get(t.sbody)||this.__body,this.__minx=parseInt(i.width)||20,this.__miny=parseInt(i.height)||20,this.__view=h._$get(t.view)||h._$getScrollViewPort(this.__body),t.lock){this.__ratio=this.__body.offsetWidth/this.__body.offsetHeight;var _=this.__minx/this.__miny;_<this.__ratio?this.__minx=this.__miny*this.__ratio:this.__miny=this.__minx/this.__ratio}this.__doInitNode(t.flag||n),this.__dragger=o._$$Dragger._$allocate({body:this.__body,view:this.__view,onchange:this.__onResizeMove._$bind(this)})},l.__destroy=function(){this.__dragger&&(this.__dragger._$recycle(),delete this.__dragger),delete this.__body,delete this.__view,delete this.__sbody,this.__super()},l.__doInitNode=function(t){for(var i,e,s=[],o=1;o<9;o++)i=h._$getByClassName(this.__body,t[o]||"js-rs-"+o),e=(i||n)[0],e&&s.push([e,"mousedown",this.__onResizeStart._$bind2(this,o)]);s.push([document,"mouseup",this.__onResizEnd._$bind(this)]),s.push([document,"mousemove",this.__onResizing._$bind(this)]),s.push([this.__body,"selectstart",_._$stop._$bind(_)]),this.__doInitDomEvent(s)},l.__doCalBoxWithLock=function(t,i){switch(this.__flag){case 1:var _=t.top+t.height,h=t.top+i.y,e=_-this.__miny,s=_-Math.floor((this.__box.w-t.left-this.__delta.x)/this.__ratio);t.top=Math.min(e,Math.max(0,h,s)),t.height=_-t.top,t.width=Math.floor(t.height*this.__ratio);break;case 2:var h=t.width+i.x,e=Math.floor((this.__box.h-t.top-this.__delta.y)*this.__ratio),s=this.__box.w-t.left-this.__delta.x;t.width=Math.max(this.__minx,Math.min(h,e,s)),t.height=Math.floor(t.width/this.__ratio);break;case 3:var _=t.left+t.width,h=t.height+i.y,e=Math.floor(_/this.__ratio),s=this.__box.h-t.top-this.__delta.y;t.height=Math.max(this.__miny,Math.min(h,e,s)),t.width=Math.floor(t.height*this.__ratio),t.left=_-t.width;break;case 4:var _=t.left+t.width,h=t.top+t.height,e=t.left+i.x,s=_-Math.floor(h*this.__ratio),o=_-this.__minx;t.left=Math.max(0,s,Math.min(e,o)),t.width=_-t.left,t.height=Math.floor(t.width/this.__ratio),t.top=h-t.height;break;case 5:var _=t.left+t.width,e=t.top+t.height,s=t.top+i.y,o=e-Math.floor(_/this.__ratio),a=e-this.__miny;t.top=Math.max(0,o,Math.min(s,a)),t.height=e-t.top,t.width=Math.floor(t.height*this.__ratio),t.left=_-t.width;break;case 6:var _=t.top+t.height,e=t.width+i.x,s=Math.floor(_*this.__ratio),o=this.__box.w-t.left-this.__delta.x;t.width=Math.max(this.__minx,Math.min(e,s,o)),t.height=Math.floor(t.width/this.__ratio),t.top=_-t.height;break;case 7:var e=t.height+i.y,s=Math.floor((this.__box.w-t.left-this.__delta.x)/this.__ratio),o=this.__box.h-t.top-this.__delta.y;t.height=Math.max(this.__miny,Math.min(e,s,o)),t.width=Math.floor(t.height*this.__ratio);break;case 8:var _=t.left+t.width,e=t.left+i.x,s=_-this.__minx,o=_-Math.floor((this.__box.h-t.top-this.__delta.y)*this.__ratio);t.left=Math.max(0,o,Math.min(e,s)),t.width=_-t.left,t.height=Math.floor(t.width/this.__ratio)}return t},l.__doCalBoxWithoutLock=function(t,i){var _;return 1!=this.__flag&&5!=this.__flag&&6!=this.__flag||(_=t.top+t.height-this.__miny,t.top=Math.min(_,Math.max(0,t.top+i.y)),t.height=_+this.__miny-t.top),2!=this.__flag&&6!=this.__flag&&7!=this.__flag||(t.width=Math.max(this.__minx,Math.min(t.width+i.x,this.__box.w-t.left-this.__delta.x))),3!=this.__flag&&7!=this.__flag&&8!=this.__flag||(t.height=Math.max(this.__miny,Math.min(t.height+i.y,this.__box.h-t.top-this.__delta.y))),4!=this.__flag&&5!=this.__flag&&8!=this.__flag||(_=t.left+t.width-this.__minx,t.left=Math.min(_,Math.max(0,t.left+i.x)),t.width=_+this.__minx-t.left),t},l.__onResizeStart=function(){var t={1:"n-resize",2:"e-resize",3:"s-resize",4:"w-resize",5:"nw-resize",6:"ne-resize",7:"se-resize",8:"sw-resize"};return function(i,h){return _._$stop(i),this.__flag=h,this.__flag&&t[this.__flag]?(this.__offset={x:_._$pageX(i),y:_._$pageY(i)},this.__doRefreshBox(),document.body.style.cursor=t[this.__flag],void this._$dispatchEvent("onresizestart",this._$getResizeBox())):void delete this.__flag}}(),l.__onResizing=function(t){if(this.__flag){var i={x:_._$pageX(t),y:_._$pageY(t)},e={x:i.x-this.__offset.x,y:i.y-this.__offset.y},t={top:parseInt(h._$getStyle(this.__body,"top"))||0,left:parseInt(h._$getStyle(this.__body,"left"))||0,width:parseInt(h._$getStyle(this.__sbody,"width"))||0,height:parseInt(h._$getStyle(this.__sbody,"height"))||0};this.__offset=i,this.__doUpdateSize(t,e)}},l.__onResizEnd=function(t){this.__flag&&(delete this.__box,delete this.__flag,delete this.__delta,delete this.__offset,document.body.style.cursor="",this._$dispatchEvent("onresizeend",this._$getResizeBox()))},l.__onResizeMove=function(t){this._$dispatchEvent("onmove",this._$getResizeBox())},l.__doRefreshBox=function(){this.__box={w:Math.max(this.__view.clientWidth,this.__view.scrollWidth),h:Math.max(this.__view.clientHeight,this.__view.scrollHeight)},this.__delta={x:this.__body.offsetWidth-this.__sbody.clientWidth,y:this.__body.offsetHeight-this.__sbody.clientHeight}},l.__doUpdateSize=function(){var t=function(t,i,_){e._$forEach(_,function(_){var e=i[_];null!=e&&h._$setStyle(t,_,e+"px")})},i=function(t){e._$loop(t,function(t,i,_){_[i]=Math.round(t)})};return function(_,h){_=this.__ratio?this.__doCalBoxWithLock(_,h):this.__doCalBoxWithoutLock(_,h),i(_),this._$dispatchEvent("onbeforeresize",_),_.stopped||(t(this.__body,_,["top","left"]),t(this.__sbody,_,["width","height"]),this._$dispatchEvent("onresize",_))}}(),l._$getResizeBox=function(){var t=this.__body.style;return{top:parseInt(t.top)||0,left:parseInt(t.left)||0,width:this.__body.offsetWidth,height:this.__body.offsetHeight}},l._$update=function(t){this.__flag=7,this.__doRefreshBox(),this.__doUpdateSize(t,{x:0,y:0})},a._$$Resize=a._$$Resizable,CMPT&&t.copy(t.P("nej.ut"),a),a});