NEJ.define(["base/global","base/klass","base/element","base/event","util/event"],function(t,_,e,i,o,s,n,h,a,r){return s._$$Draggable=_._$klass(),r=s._$$Draggable._$extend(o._$$EventTarget),r.__reset=function(t){this.__super(t),this.__overflow=!!t.overflow,this.__body=e._$get(t.body),this.__mbar=e._$get(t.mbar)||this.__body,this.__view=e._$get(t.view)||e._$getPageBox(),this.__direction=parseInt(t.direction)||0,this.__doInitDomEvent([[document,"mouseup",this.__onDragEnd._$bind(this)],[document,"mousemove",this.__onDragging._$bind(this)],[this.__mbar,"mousedown",this.__onDragStart._$bind(this)]])},r.__destroy=function(){this.__super(),this.__onDragEnd(),delete this.__body,delete this.__mbar,delete this.__view},r.__getMaxRange=function(){return{x:this.__view.clientWidth-this.__body.offsetWidth,y:this.__view.clientHeight-this.__body.offsetHeight}},r.__onDragStart=function(t){i._$stop(t),this.__offset||(this.__offset={x:i._$pageX(t),y:i._$pageY(t)},this.__maxbox=this.__getMaxRange())},r.__onDragging=function(t){if(this.__offset){i._$stop(t);var _={x:i._$pageX(t),y:i._$pageY(t)},o=_.x-this.__offset.x,s=_.y-this.__offset.y,n=parseInt(e._$getStyle(this.__body,"top"))||0,h=parseInt(e._$getStyle(this.__body,"left"))||0,a={top:n+s,left:h+o};this.__offset=_,this._$setPosition(a)}},r.__onDragEnd=function(t){this.__offset&&(delete this.__maxbox,delete this.__offset,this._$dispatchEvent("ondragend",this._$getPosition()))},r.__doFixPosition=function(t){if(!this.__overflow){var _=this.__maxbox||this.__getMaxRange();t.top=Math.min(_.y,Math.max(0,t.top)),t.left=Math.min(_.x,Math.max(0,t.left))}},r._$setPosition=function(t){t.top=Math.round(t.top),t.left=Math.round(t.left),this.__doFixPosition(t),this._$dispatchEvent("onbeforechange",t),this.__doFixPosition(t);var _=this.__body.style;0!=this.__direction&&2!=this.__direction||(_.top=t.top+"px"),0!=this.__direction&&1!=this.__direction||(_.left=t.left+"px"),this._$dispatchEvent("onchange",t)},r._$getPosition=function(){return{left:parseInt(e._$getStyle(this.__body,"left"),10)||0,top:parseInt(e._$getStyle(this.__body,"top"),10)||0}},s._$$Dragger=s._$$Draggable,CMPT&&t.copy(t.P("nej.ut"),s),s});