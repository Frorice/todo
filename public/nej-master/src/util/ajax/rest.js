NEJ.define(["base/global","base/event","base/util","base/constant","util/ajax/xdr","util/event/event"],function(e,t,n,r,o,a,i,l,s,u){return i._$request=function(){var e={},a=/\{(.*?)\}/gi,i=/^get|delete|head$/i,c=/json/i,d=/xml/i,f=function(t){var n=e[t];n&&(delete n.s,delete n.f,delete e[t])},v=function(t,n){var r=e[t];if(r){var o=r[n],a=u.slice.call(arguments,2);try{(o||s).apply(null,a)}catch(e){if(DEBUG)throw e;console.error(e.message),console.error(e)}f(t)}},$=function(e,t){v(e,"s",t)},_=function(e,n){return n=n||{},n.code==r._$CODE_ERRSERV&&204==n.data?void $(e,null):(t._$dispatchEvent(window,"resterror",n),n.stopped?void f(e):void v(e,"f",n))},p=function(e,t,n){var r=e[t]||e[t.toLowerCase()];return r||(r=n,e[t]=r),r},m=function(e,t,r){n._$isArray(e)&&(r[t]=JSON.stringify(e))};return function(t,r){r=n._$merge({},r);var u={},f=r.param||l;t=t.replace(a,function(e,t){var n=f[t];return null!=n&&(u[t]=!0),encodeURIComponent(n||"")||e});var v=r.data||{};n._$loop(f,function(e,t){u[t]||(v[t]=e)});var b="text",h=r.headers||{},y=p(h,"Accept","application/json"),E=p(h,"Content-Type","application/json");c.test(y)?b="json":d.test(y)&&(b="xml");var g=n._$uniqueID();return e[g]={s:r.onload||s,f:r.onerror||s},r.method=r.method||"GET",i.test(r.method.trim())?(n._$forIn(v,m),r.query=v,v=null):c.test(E)&&(v=JSON.stringify(v)),r.type=b,r.data=v,r.headers=h,r.onload=$._$bind(null,g),r.onerror=_._$bind(null,g),o._$request(t,r)}}(),i._$abort=function(e){o._$abort(e)},a._$$CustomEvent._$allocate({element:window,event:"resterror"}),CMPT&&(e.P("nej.j")._$requestByREST=i._$request),i});