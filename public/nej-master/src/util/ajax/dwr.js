NEJ.define(["base/global","base/constant","base/util","util/ajax/xdr","util/ajax/tag","util/cache/cookie"],function(e,n,t,o,r,a,i,c,l,u){var s,d=l,_={},m="JSESSIONID",$=null;i._$setFilter=function(e){d=t._$isFunction(e)?e:l},i._$setCookieName=function(e){m=e||m},i._$setBatchId=function(e){s=e||""},i._$begin=function(){$||($={h:{},p:0,m:{callCount:0,scriptSessionId:"${scriptSessionId}190",httpSessionId:a._$cookie(m)},r:{script:!1,sync:!1,method:"POST",timeout:null,proxy:!0,cookie:!1,onbeforerequest:null}})},i._$request=function(e,o){var r=(e||"").split(".");if(r&&2==r.length){var u=!1;o=o||c,$||(u=!0,i._$begin(),o.session&&($.m.httpSessionId=a._$cookie(o.session))),$.u=(o.path||"/dwr/call/plaincall/")+(o.query&&"?"+o.query||""),t._$fetch($.r,o);var s=t._$merge($.r.headers,o.headers);s[n._$HEAD_CT]=n._$HEAD_CT_PLAN,$.r.headers=s;var d="c"+$.m.callCount;$.m[d+"-scriptName"]=r[0],$.m[d+"-methodName"]=r[1],$.m[d+"-id"]=$.m.callCount,$.h[$.m.callCount]={c:o.onload||l,e:o.onerror||l},t._$forEach(o.param,function(e,n){var t=p(e,d);t&&($.m[d+"-param"+n]=t)}),$.m.callCount++,u&&i._$end()}},i._$end=function(){if(!$||!$.u)return void($=null);var e=s||t._$uniqueID();s=0,$.m.batchId=e,_[e]=$,$=null,E(e)};var h=function(e){var n=_[e];n&&(delete n.h,delete n.m,delete _[e])},p=function(e,n){return null==e?"null:null":t._$isBoolean(e)?"boolean:"+!!e:t._$isNumber(e)?"number:"+e:t._$isString(e)?"string:"+encodeURIComponent(e):t._$isDate(e)?"Date:"+e.getTime():t._$isArray(e)?C(e,n):t._$isObject(e)?v(e,n):t._$isFunction(e,"function")?"":"default:"+e},C=function(e,n){var o=[];return t._$forEach(e,function(e,t){$.p++;var r=n+"-e"+$.p,a=p(e,n);a&&($.m[r]=a,o.push("reference:"+r))}),"Array:["+o.join(",")+"]"},v=function(e,n){var o=[];return t._$forIn(e,function(e,t){$.p++;var r=n+"-e"+$.p,a=p(e,n);a&&($.m[r]=a,o.push(encodeURIComponent(t)+":reference:"+r))}),"Object_Object:{"+o.join(",")+"}"},b=function(e,n){if(!e)return null;var o=[],r="&"==n;return t._$forIn(e,function(e,n){o.push(r?encodeURIComponent(n)+"="+encodeURIComponent(e):n+"="+e)}),o.join(n||"\n")},E=function(e){var n=_[e];if(n){n.u=n.u.replace(/(\?|$)/,(n.m.callCount>1?"Multiple."+n.m.callCount:n.m["c0-scriptName"]+"."+n.m["c0-methodName"])+".dwr$1");var t=n.r,a=!!t.script,i="POST"==t.method;delete n.r,delete t.script,t.method=t.method.toUpperCase(),t.onerror=B._$bind(null,e),!a&&i||(n.u+=(n.u.indexOf("?")>=0?"&":"?")+b(n.m,"&")),a?r._$loadScript(n.u,t):(t.onload=D._$bind(null,e),t.data=i?b(n.m):null,o._$request(n.u,t))}},g=function(e,n,t){var o=_[e];if(o&&!d(t)){var r=o.h[n];if(r)try{(r.e||f)(t)}catch(e){if(DEBUG)throw e;console.error(e.message),console.error(e)}}},I=function(e,n){var o=_[e];o&&t._$forIn(o.h,function(t,o){g(e,o,n)})},R=function(e,t,o){var r=_[e];if(r)try{(r.h[t].c||f)(o)}catch(o){g(e,t,{code:n._$CODE_ERRCABK,message:"DWR回调执行异常："+o.message||o})}},D=function(e,t){try{t&&t.search("//#DWR")>=0?new Function(t)():I(e,{code:n._$CODE_ERRSERV,message:"DWR请求返回数据不合法!"})}catch(t){I(e,{code:n._$CODE_ERREVAL,message:"DWR返回脚本执行异常："+(t.message||t)})}finally{h(e)}},B=function(e,n){I(e,n),h(e)};this.dwr=this.dwr||{};var S=dwr.engine=dwr.engine||{};if(S._remoteHandleCallback=R,S._remoteHandleException=g,S._remoteHandleBatchException=I,dwr._=[{handleCallback:S._remoteHandleCallback,handleException:S._remoteHandleException,handleBatchException:S._remoteHandleBatchException}],CMPT){var x=e.P("nej.j");x._$endBatch=i._$end,x._$requestByDWR=i._$request,x._$beginBatch=i._$begin,x._$setFilter=i._$setFilter,x._$setBatchId=i._$setBatchId,x._$setCookieName=i._$setCookieName}return i});