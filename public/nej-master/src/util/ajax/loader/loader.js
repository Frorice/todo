NEJ.define(["base/global","base/klass","base/constant","base/event","base/util","util/event"],function(t,e,_,o,i,s,r,a,n,h){var d,u=6e4;return r._$$LoaderAbstract=e._$klass(),d=r._$$LoaderAbstract._$extend(s._$$EventTarget),d.__init=function(){this.__super(),this.__qopt={onerror:this.__onQueueError._$bind(this),onload:this.__onQueueLoaded._$bind(this)},this.constructor.__cache||(this.constructor.__cache={loaded:{}})},d.__reset=function(t){this.__super(t),this.__version=t.version,this.__timeout=t.timeout,this.__qopt.version=this.__version,this.__qopt.timeout=this.__timeout},d.__delLoadData=function(t){delete this.constructor.__cache[t]},d.__getLoadData=function(t){return this.constructor.__cache[t]},d.__setLoadData=function(t,e){this.constructor.__cache[t]=e},d.__getRequest=n,d.__doClearRequest=function(t){o._$clearEvent(t)},d.__doRequest=function(t){t.src=this.__url,document.head.appendChild(t)},d.__doClear=function(){var t=this.__getLoadData(this.__url);t&&(window.clearTimeout(t.timer),this.__doClearRequest(t.request),delete t.bind,delete t.timer,delete t.request,this.__delLoadData(this.__url),this.__getLoadData("loaded")[this.__url]=!0)},d.__doCallback=function(t){var e=this.__getLoadData(this.__url);if(e){var _=e.bind;if(this.__doClear(),_&&_.length>0)for(var o;_.length;){o=_.shift();try{o._$dispatchEvent(t,arguments[1])}catch(t){if(DEBUG)throw t;console.error(t.message),console.error(t.stack)}o._$recycle()}}},d.__onError=function(t){this.__doCallback("onerror",t)},d.__onLoaded=function(){this.__doCallback("onload")},d.__doLoadQueue=function(t){this.constructor._$allocate(this.__qopt)._$load(t)},d.__onQueueCheck=function(t){var e=this.__getLoadData(this.__key);e&&(t&&e.error++,e.loaded++,e.loaded<e.total||(this.__delLoadData(this.__key),this._$dispatchEvent(e.error>0?"onerror":"onload")))},d.__onQueueError=function(t){this.__onQueueCheck(!0)},d.__onQueueLoaded=function(){this.__onQueueCheck()},d._$load=function(t){if(t=i._$absolute(t),!t)return void this._$dispatchEvent("onerror",{code:_._$CODE_NOTASGN,message:"请指定要载入的资源地址！"});if(this.__url=t,this.__version&&(this.__url+=(this.__url.indexOf("?")<0?"?":"&")+this.__version),this.__getLoadData("loaded")[this.__url]){try{this._$dispatchEvent("onload")}catch(t){if(DEBUG)throw t;console.error(t.message),console.error(t.stack)}return void this._$recycle()}var e,s=this.__getLoadData(this.__url);s?(s.bind.unshift(this),s.timer=window.clearTimeout(s.timer)):(e=this.__getRequest(),s={request:e,bind:[this]},this.__setLoadData(this.__url,s),o._$addEvent(e,"load",this.__onLoaded._$bind(this)),o._$addEvent(e,"error",this.__onError._$bind(this,{code:_._$CODE_ERRSERV,message:"无法加载指定资源文件["+this.__url+"]！"}))),0!=this.__timeout&&(s.timer=window.setTimeout(this.__onError._$bind(this,{code:_._$CODE_TIMEOUT,message:"指定资源文件["+this.__url+"]载入超时！"}),this.__timeout||u)),e&&this.__doRequest(e),this._$dispatchEvent("onloading")},d._$queue=function(t){if(!t||!t.length)return void this._$dispatchEvent("onerror",{code:_._$CODE_NOTASGN,message:"请指定要载入的资源队列！"});this.__key=i._$uniqueID();var e={error:0,loaded:0,total:t.length};this.__setLoadData(this.__key,e),i._$forEach(t,function(t,_){return t?void this.__doLoadQueue(t):void e.total--},this),this._$dispatchEvent("onloading")},r});