NEJ.define(["base/klass","base/util","base/element","base/config","base/constant","util/event","util/cache/cookie","util/encode/json"],function(e,t,s,r,_,o,n,i,a,h,d,u){var c;return a._$$ProxyAbstract=e._$klass(),c=a._$$ProxyAbstract._$extend(o._$$EventTarget),c.__reset=function(e){this.__super(e),this.__request=t._$fetch({url:"",sync:!1,cookie:!1,type:"text",method:"GET",timeout:6e4},e);var s=r._$get("csrf");if(s.cookie&&s.param){var o=encodeURIComponent(s.param)+"="+encodeURIComponent(n._$cookie(s.cookie)||""),i=this.__request.url.indexOf("?")<0?"?":"&";this.__request.url+=i+o}this.__headers=e.headers||{};var a=this.__headers[_._$HEAD_CT];null==a&&(this.__headers[_._$HEAD_CT]=_._$HEAD_CT_FORM)},c.__destroy=function(){this.__super(),delete this.__rkey,delete this.__request,delete this.__headers},c.__onLoadRequest=function(e){var t=e.status;return t==-1?void this._$dispatchEvent("onerror",{code:_._$CODE_TIMEOUT,message:"请求["+this.__request.url+"]超时！"}):0!=(""+t).indexOf("2")?void this._$dispatchEvent("onerror",{data:t,result:e.result,code:_._$CODE_ERRSERV,message:"服务器返回异常状态["+t+"]!"}):void this._$dispatchEvent("onload",s._$text2type(e.result,this.__request.type))},c.__doSendRequest=d,c.__getResponseHeader=d,c.__onAbort=function(){this._$dispatchEvent("onerror",{code:_._$CODE_ERRABRT,message:"客户端终止请求"})},c._$send=function(e){var t=this.__request.url;if(!t)return void this._$dispatchEvent("onerror",{code:_._$CODE_NOTASGN,message:"没有输入请求地址！"});try{this.__request.data=null==e?null:e;var s={request:this.__request,headers:this.__headers};try{this._$dispatchEvent("onbeforerequest",s)}catch(e){console.error(e.message),console.error(e.stack)}this.__doSendRequest(s)}catch(e){this._$dispatchEvent("onerror",{code:_._$CODE_ERRSERV,message:"请求["+t+"]失败:"+e.message+"！"})}},c._$abort=d,c._$header=function(e){if(!t._$isArray(e))return this.__getResponseHeader(e)||"";var s={};return t._$forEach(e,function(e){s[e]=this._$header(e)},this),s},a});