NEJ.define(["base/klass","base/event","base/element","util/event"],function(t,_,i,e,o,s,r,l,n){o._$$SmartScroll=t._$klass(),n=o._$$SmartScroll._$extend(e._$$EventTarget),n.__reset=function(t){this.__super(t);var _=i._$get(t.viewport);this.__viewport=_||i._$getScrollViewPort(),this.__step=parseInt(t.step)||50,this.__rtmp=t.range,this.__doUpdateLimit(t.limit),this.__doInitDomEvent([[_||document,"mousemove",this.__onScrollCheck._$bind(this)],[document,"mouseup",this.__doStopScroll._$bind(this)]])},n.__destroy=function(){this.__super(),this.__doStopScroll(),delete this.__rtmp,delete this.__range,delete this.__limit,delete this.__viewport},n.__doUpdateLimit=function(t){this.__viewport.scrollHeight;t=t||l,this.__limit=[t[0]||0,t[1]||0]},n.__doUpdateRange=function(){var t=function(t,_,i){return t=parseInt(t)||i,t<0?_+t:0<t&&t<1?Math.floor(_*t):t};return function(_){var i=this.__rtmp||l,e=this.__viewport.clientHeight,o=t(i[0],e,.2),s=t(i[1],e,.8);this.__range=[Math.min(o,s),Math.max(o,s)],delete this.__rtmp}}(),n.__doAutoScroll=function(t){return t?(this.__flag=t,void(this.__timer||(this.__timer=window.setInterval(this.__doAutoScrollStep._$bind(this),20)))):void this.__doStopScroll()},n.__doAutoScrollStep=function(){this.__count=(this.__count||0)+1;var t=this.__viewport.scrollTop+this.__flag*Math.min(this.__step,this.__count);this.__flag<0?this.__viewport.scrollTop=Math.max(this.__limit[0],t):this.__viewport.scrollTop=Math.min(this.__viewport.scrollHeight-this.__limit[1],t)},n.__doStopScroll=function(){delete this.__flag,delete this.__count,this.__timer=window.clearInterval(this.__timer)},n.__onScrollCheck=function(t){var e={};if(this._$dispatchEvent("onscrollcheck",e),e.stopped)return void this.__doStopScroll();this.__range||this.__doUpdateRange();var o=this.__range,s=_._$clientY(t)-i._$offset(this.__viewport).y;this.__doAutoScroll(s<=o[0]?-1:s>=o[1]?1:0)}});