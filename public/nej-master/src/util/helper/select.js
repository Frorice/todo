NEJ.define(["base/global","base/klass","base/element","base/event","util/event"],function(e,t,_,s,i,n,o,h,l,r){return n._$$SelectHelper=t._$klass(),r=n._$$SelectHelper._$extend(i._$$EventTarget),r.__reset=function(e){this.__super(e),this.__loop=!!e.loopable,this.__parent=_._$get(e.parent),this.__selected=e.selected||"js-selected",this.__hovered=e.hover||this.__selected,this.__nopt={},e.clazz&&(this.__nopt.filter=_._$hasClassName._$bind2(_,e.clazz),this.__clazz=e.clazz),this.__kbody=this.__getKeyBoardParent(this.__parent),this.__doInitDomEvent([[this.__kbody,"keydown",this.__doCheckKBAction._$bind(this),!0],[this.__kbody,"enter",this.__doCheckKBEnter._$bind(this)],[this.__parent,"click",this.__onCheckClick._$bind(this)],[this.__parent,"mouseover",this.__onCheckHover._$bind(this)],[this.__parent,"mouseleave",this.__onCheckLeave._$bind(this)]])},r.__destroy=function(){this.__super(),delete this.__selected,delete this.__hovered,delete this.__parent,delete this.__kbody,delete this.__clazz,delete this.__nopt,delete this.__loop},r.__isItemElement=function(e){return this.__clazz?_._$hasClassName(e,this.__clazz):e.parentNode==this.__parent},r.__getKeyBoardParent=function(){var e=1e3;return function(t){for(;t&&(parseInt(t.tabIndex)||0)<=e;)t=t.parentNode;return t||document}}(),r.__getItemElement=function(e){var t=_._$getByClassName(this.__parent,e);return t?t[0]:null},r.__doSyncSelection=function(e,t){_._$delClassName(e.last,t),_._$addClassName(e.target,t),t==this.__selected&&e.last!=e.target&&(this.__doScrollToView(e.target),this._$dispatchEvent("onchange",e))},r.__doScrollToView=function(e){var t=_._$getScrollViewPort(e),s=_._$offset(e,t);if(s.y-t.scrollTop<0)return void(t.scrollTop=s.y);var i=s.y+e.offsetHeight-t.clientHeight;i>t.scrollTop&&(t.scrollTop=i)},r.__doParseSelection=function(e,t){var _=s._$getElement(e,this.__isItemElement._$bind(this));return _?{last:this.__getItemElement(t),target:_}:null},r.__doCheckKBAction=function(e){var t=e.keyCode;if(38==t||40==t){s._$stop(e);var i={last:this._$getSelectedNode()};this.__nopt.backward=38==t;var n=this.__clazz?_._$getByClassName(this.__parent,this.__clazz):_._$getChildren(this.__parent),o=this.__nopt.backward?n[n.length-1]:n[0];if(i.last?i.target=_._$getSibling(i.last,this.__nopt):i.target=this.__getItemElement(this.__hovered)||o,!i.target){if(!this.__loop||n.length<=1)return;i.target=o}this.__doSyncSelection(i,this.__selected)}},r.__doCheckKBEnter=function(e){s._$stop(e),this._$dispatchEvent("onselect",{enter:!0,target:this._$getSelectedNode()})},r.__onCheckClick=function(e){s._$stop(e);var t=this.__doParseSelection(e,this.__selected);t&&(this.__doSyncSelection(t,this.__selected),this._$dispatchEvent("onselect",{target:t.target}))},r.__onCheckHover=function(e){var t=this.__doParseSelection(e,this.__hovered);t&&(this.__doSyncSelection(t,this.__hovered),this.__kbody.focus&&this.__kbody.focus())},r.__onCheckLeave=function(e){this.__hovered!=this.__selected&&_._$delClassName(this.__getItemElement(this.__hovered),this.__hovered)},r._$getSelectedNode=function(){return this.__getItemElement(this.__selected)},CMPT&&e.copy(e.P("nej.ut"),n),n});