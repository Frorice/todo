NEJ.define(["base/global","base/klass","base/element","base/event","base/util","util/event"],function(e,t,n,_,i,s,o,h,a,c){var d;return o._$$CustomEvent=t._$klass(),d=o._$$CustomEvent._$extend(s._$$EventTarget),d.__init=function(){this.__cache={},this.__super()},d.__reset=function(e){this.__super(e),this.__element=n._$get(e.element)||window,this.__doEventInit(e.event),this.__doEventAPIEnhance(),this._$dispatchEvent("oninit")},d.__destroy=function(){var e=function(e,t,n){i._$isArray(e)||i._$safeDelete(this.__element,t),delete n[t]};return function(){this.__super(),i._$loop(this.__cache,e,this),delete this.__element}}(),d.__isDelegate=function(e,t){return e=n._$get(e),!(e!==this.__element||t&&!this.__cache["on"+t])},d.__doEventInit=function(e){if(i._$isString(e)){var t="on"+e;return this.__cache[t]||(this.__cache[t]=this.__doEventDispatch._$bind(this,e)),void this.__doEventBind(e)}i._$isArray(e)&&i._$forEach(e,this.__doEventInit,this)},d.__doEventBind=function(e){var t="on"+e,n=this.__element[t],_=this.__cache[t];n!=_&&(this.__doEventDelete(e),n&&n!=a&&this.__doEventAdd(e,n),this.__element[t]=_)},d.__doEventAdd=function(e,t,n){var _=this.__cache[e];_||(_=[],this.__cache[e]=_),i._$isFunction(t)&&(n?_.unshift(t):_.push(t))},d.__doEventDelete=function(e,t){var n=this.__cache[e];if(n&&n.length)return t?void i._$reverseEach(n,function(e,n,_){if(t===e)return _.splice(n,1),!0}):void delete this.__cache[e]},d.__doEventDispatch=function(e,t){t=t||{noargs:!0},t==h&&(t={}),t.type=e,this._$dispatchEvent("ondispatch",t),t.stopped||i._$forEach(this.__cache[e],function(e){if(DEBUG)e(t);else try{e(t)}catch(e){console.error(e.message),console.error(e.stack)}})},d.__doEventAPIEnhance=function(){var t=function(e){var t=e.args,n=t[1].toLowerCase();this.__isDelegate(t[0],n)&&(e.stopped=!0,this.__doEventBind(n),this.__doEventAdd(n,t[2],t[3]),this._$dispatchEvent("oneventadd",{type:n,listener:t[2]}))},n=function(e){var t=e.args,n=t[1].toLowerCase();this.__isDelegate(t[0],n)&&(e.stopped=!0,this.__doEventDelete(n,t[2]))},s=function(e){var t=e.args,n=(t[1]||"").toLowerCase();if(this.__isDelegate(t[0])){if(n)return void this.__doEventDelete(n);i._$loop(this.__cache,function(e,t){i._$isArray(e)&&this.__doEventDelete(t)},this)}},o=function(e){var t=e.args,n=t[1].toLowerCase();this.__isDelegate(t[0],n)&&(e.stopped=!0,t[0]["on"+n].apply(t[0],t.slice(2)))};return function(){this.__enhanced||(this.__enhanced=!0,_._$addEvent=_._$addEvent._$aop(t._$bind(this)),_._$delEvent=_._$delEvent._$aop(n._$bind(this)),_._$clearEvent=_._$clearEvent._$aop(s._$bind(this)),_._$dispatchEvent=_._$dispatchEvent._$aop(o._$bind(this)),CMPT&&e.copy(e.P("nej.v"),_))}}(),CMPT&&e.copy(e.P("nej.ut"),o),o});