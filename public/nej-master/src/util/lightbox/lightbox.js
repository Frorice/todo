NEJ.define(["base/global","base/klass","base/util","base/event","base/element","util/event","ui/lightbox/lightbox"],function(t,e,i,n,_,o,s,a,l,h,r){var u;return a._$$LightBox=e._$klass(),u=a._$$LightBox._$extend(o._$$EventTarget),u.__init=function(){this.__lopt={parent:document.body},this.__super()},u.__reset=function(t){this._$setEvent("onlightbox",this.__onLightBoxShow._$bind(this)),this.__super(t),i._$merge(this.__lopt,i._$fetch({mask:null,clazz:null,loading:null,disabled:null},t)),this.__parent=_._$get(t.parent),this.__doInitDomEvent([[this.__parent,"click",this.__onCheckImage._$bind(this)]])},u.__destroy=function(){delete this.__parent,this.__super()},u.__onCheckImage=function(){var t=function(t){return{group:_._$dataset(t,"group"),src:_._$dataset(t,"src")||t.src,title:t.alt||_._$dataset(t,"title")}};return function(e){var _=n._$getElement(e);if("IMG"==_.tagName){n._$stop(e);var o=t(_);if(!o.group)return void this._$dispatchEvent("onlightbox",{index:0,list:[o]});var s=[],a=0;i._$forEach(this.__parent.getElementsByTagName("img"),function(e){var i=t(e);i.group===o.group&&(s.push(i),_==e&&(a=s.length-1))}),this._$dispatchEvent("onlightbox",{index:a,list:s})}}}(),u.__onLightBoxShow=function(t){this.__lopt.list=t.list,this.__lopt.index=t.index,s._$$LightBox._$allocate(this.__lopt)},a._$lightbox=function(t){return a._$$LightBox._$allocate(t)},CMPT&&t.copy(t.P("nej.ut"),a),a});