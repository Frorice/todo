NEJ.define(["./history.js","base/element"],function(t,e,n,o,i,c){return NEJ.patch("TR<=4.0",function(){window.hst_lock={},t.__pushHistory=function(){var n,o,i=[],c="cb-"+ +new Date,a='<script>parent.hst_lock["'+c+'"] = !0;parent.location.hash = decodeURIComponent("#<HASH>");</script>',r=function(){if(n=window.clearTimeout(n),i.length){var t=i.shift();try{var e=o.contentWindow.document;e.open(),e.write("<head><title>"),e.write(document.title),e.write("</title>"),e.write(a.replace("#<HASH>",encodeURIComponent(t))),e.write("</head><body></body>"),location.hostname!=document.domain&&(e.domain=document.domain),e.close(),hst_lock[c]=!1}catch(e){console.log(e.message||e),i.unshift(t)}n=window.setTimeout(r,50)}};return function(n){t[c]||!o&&!n||(i.push(n),o||(o=e._$createXFrame()),r())}}()}),t});