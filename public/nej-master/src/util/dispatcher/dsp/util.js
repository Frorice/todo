NEJ.define(["base/util","./node.js","../module.js"],function(n,t,e,r,i,u,o){var a=function(t,e,r){var i=t,r=r||u;return"/"!=e&&n._$forEach(e.split("/"),function(n){var t=r(i,n);return!t||void(i=t)}),i};return r._$getNodeByUMI=function(){var n=function(n,t){var t=t||"/",e=n._$getName();return"/"==e&&"/"==t?n:n._$getChildByName(t)};return function(t,e){return a(t,e,n)}}(),r._$appendNodeByUMI=function(){var n=function(n,e){var r=n._$getName();if(!e&&"/"==r)return n;var i=null;return"/"!=r&&(i=n._$getChildByName("/"),i||(i=t._$$Node._$allocate(),n._$appendChild(i))),e&&(i=n._$getChildByName(e),i||(i=t._$$Node._$allocate({name:e}),n._$appendChild(i))),i};return function(t,e){return a(t,e,n)}}(),r._$getCommonRoot=function(t,e,i){if(!e||!i)return t;var e=e._$getPath().split("/"),i=i._$getPath().split("/"),u=n._$forIn(e,function(n,t){if(n!=i[t])return!0})||1,o=e.splice(0,u).join("/")||"/";return r._$getNodeByUMI(t,o)},r._$breadthFirstSearch=function(n,t){for(var e=[n],r=e.shift(),t=t||u;r;)e.push.apply(e,r._$getChildren()),t(r),r=e.shift()},r._$isNode=function(n){return n instanceof t._$$Node},r._$isModule=function(n){return n instanceof e._$$ModuleAbstract},r._$isUMIPrivate=function(){var n=/^\/?\?(?=\/|$)/;return function(t){return n.test(t||"")}}(),r._$path2umi=function(){var n=/[\?#]/;return function(t){var e=(t||"").trim().split(n),r="/"==e[0]&&0==(e[1]||"").indexOf("/");return e[0]+(r?"?"+e[1]:"")}}(),r});