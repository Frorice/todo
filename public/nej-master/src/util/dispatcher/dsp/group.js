NEJ.define(["base/util","base/klass","base/constant","base/element","util/ajax/tag","util/event","util/template/tpl","./util.js"],function(e,t,o,_,i,s,d,n,a,r,h,u){var l;return a._$$GroupManager=t._$klass(),l=a._$$GroupManager._$extend(s._$$EventTarget),l.__reset=function(e){this.__super(e),this.__root=e.root,this.__dispatcher=e.dispatcher,this.__mpool={}},l.__destroy=function(){this.__super(),delete this.__root,delete this.__mpool,delete this.__dispatcher},l.__isStopped=function(e){return!!n._$isNode(e)&&(!!e._$getData().stopped||this.__isStopped(e._$getParent()))},l.__doClearStopped=function(e){n._$isNode(e)&&(delete e._$getData().stopped,this.__doClearStopped(e._$getParent()))},l.__doModuleHide=function(e,t){this.__doModuleCheck("onhide",e,t)},l.__doModuleShow=function(e,t){this.__doModuleCheck("onshow",e,t),this.__doModuleAction(e)},l.__doModuleRefresh=function(e){this.__doModuleCheck("onrefresh",e),this.__doModuleAction(e)},l.__doModuleCheck=function(e,t,o){t!=o&&n._$isNode(t)&&("onhide"==e&&this.__doModuleDispatch(t,e),this.__doModuleCheck(e,t._$getParent(),o),"onhide"!=e&&this.__doModuleDispatch(t,e))},l.__doModuleAction=function(t){if(!n._$isNode(t))return!0;var o=t._$getData(),_=o.action,i=o.module;if(!this.__doModuleAction(t._$getParent())||_&&e._$isString(i))return!1;if(i&&i._$allocate&&_&&"onhide"!=_){if(this.__isStopped(t))return;var s={umi:t._$getPath(),config:o.config,composite:o.composite,dispatcher:this.__dispatcher};i=i._$allocate(s),n._$isModule(i)?(o.module=i,this.__doModuleDispatch(t,"onshow")):delete o.module}return delete o.action,!0},l.__doModuleDispatch=function(){var t=function(e){var t;for(e=e._$getParent();e;){if(t=e._$getData().module,n._$isModule(t))return t._$getExportData();e=e._$getParent()}return null};return function(o,s){if(n._$isNode(o)){var a=o._$getData(),h=a.module,u="onhide"!=s;if(n._$isModule(h)){if(u&&this.__isStopped(o))return;var l=this.__source?this.__source._$getData().event:a.event;l&&(l.umi=o._$getPath(),l.data=t(o));var c=a.xname||"onhide";"onshow"==s&&"onhide"!=c&&(s="onrefresh"),"onrefresh"==s&&"onhide"==c&&(s="onshow"),a.xname=s,h._$dispatchEvent(s,l||{}),u&&l&&l.pos&&l.umi==l.target&&_._$scrollTo(l.pos),u&&l&&(a.stopped=l.stopped,delete l.stopped)}else if(h&&(a.action=s,"onshow"==s&&e._$isString(h))){var p=_._$get("umi://"+h);if(p)d._$parseTemplate(p);else{var $=location.config||r;i._$loadHtml(($.root||"")+h,{version:($.ver||r)[h],onload:d._$parseTemplate})}}}}}(),l._$hasUMI=function(e){return!!this.__mpool[e]},l._$addUMI=function(e){this.__mpool[e]=!0},l._$delUMI=function(e){delete this.__mpool[e]},l._$loadedUMI=function(e){this._$hasUMI(e)&&this.__doModuleAction(n._$getNodeByUMI(this.__root,e))},l._$dispatchUMI=function(e){if(this._$hasUMI(e)){var t=n._$getNodeByUMI(this.__root,e);this.__doClearStopped(t),this.__doModuleShow(t)}},l._$hideUMI=function(e){this._$hasUMI(e)&&this.__doModuleHide(n._$getNodeByUMI(this.__root,e))},a});