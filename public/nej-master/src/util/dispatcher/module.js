NEJ.define(["base/global","base/klass","base/element","base/util","util/event","./dispatcher.js"],function(t,e,i,_,s,o,n,r,h,a){var d;return n._$$ModuleAbstract=e._$klass(),d=n._$$ModuleAbstract._$extend(s._$$EventTarget),d.__init=function(t){this.__super(t),this.__export={},this.__doBuild(t.config)},d.__reset=function(t){this.__super(t),this.__umi=t.umi||"",this.__dispatcher=t.dispatcher,this.__composites=t.composite||r,this._$batEvent({onshow:this.__onShow._$bind(this),onhide:this.__onHide._$bind(this),onrefresh:this.__onRefresh._$bind(this),onmessage:this.__onMessage._$bind(this),onbeforehide:this.__onBeforeHide._$bind(this)})},d.__destroy=function(){this.__super(),this.__export={},delete this.__umi,delete this.__composites,delete this.__dispatcher},d.__stop=function(t){t&&(t.stopped=!0)},d.__doBuild=h,d.__onBeforeHide=h,d.__doClearComponentExDsp=function(){var t=function(t){return!!o._$$Dispatcher&&t instanceof o._$$Dispatcher};return function(){this.__doClearComponent(t)}}(),d.__onMessage=h,d.__doSendMessage=function(t,e,i){this.__dispatcher._$message({to:t,mode:i||0,data:e,from:this.__umi})},d.__doPublishMessage=function(t,e){this.__dispatcher._$publish(t,{from:this.__umi,data:e})},d.__doSubscribeMessage=function(){this.__dispatcher._$subscribe.apply(this.__dispatcher,arguments)},d._$getExportData=function(){return this.__export},d.__doParseParent=function(t){var e;if(!e){var _=t.input||r;e=i._$get(_.parent)}if(!e){var _=t.data||r;e=i._$get(_.parent)}return e||(e=i._$get(t.parent)),e},d.__onShow=function(t){var e=this.__doParseParent(t);e&&this.__body&&e.appendChild(this.__body),this.__doApplyComposite("onshow",t),this.__onRefresh(t)},d.__onRefresh=function(t){this.__doApplyComposite("onrefresh",t)},d.__onHide=function(){this.__doHideComposite(),i._$removeByEC(this.__body)},d.__isEscapedComposite=function(){var t=/^onshow|onrefresh|delay$/;return function(e){return t.test(e)}}(),d.__doGenCompositeParam=h,d.__doApplyComposite=function(){var t=function(t,e,i,_){if(!this.__isEscapedComposite(_)){t&&(i+=(i.indexOf("?")>1?"&":"?")+t);var s=this.__doGenCompositeParam(_,e)||{};s.location=e,s.parent=this.__export[_],this.__dispatcher._$redirect(i,{input:s})}};return function(e,i){if(!i.nodelay){if(this.__composites.delay)return;var s=this.__composites[e]||r;if(s.delay)return}var o=_._$object2query(i.param)||"";"onrefresh"==e&&_._$loop(this.__composites,t._$bind(this,o,i)),_._$loop(s,t._$bind(this,o,i))}}(),d.__doHideComposite=function(){var t=function(t,e){this.__isEscapedComposite(e)||this.__dispatcher._$hide(t)};return function(){_._$loop(this.__composites,t,this),_._$loop(this.__composites.onshow,t,this),_._$loop(this.__composites.onrefresh,t,this)}}(),n._$regist=function(){var t;return n._$dumpModules=function(){t&&(_._$loop(t,function(t,e){dispatcher._$loaded(e,t)}),t=null)},function(e,i){window.dispatcher?dispatcher._$loaded.apply(dispatcher,arguments):(t||(t={}),t[e]=i)}}(),CMPT&&(t.P("nej.e")._$regist=n._$regist,t.P("nej.ut")._$$Module=n._$$ModuleAbstract,t.P("nej.ut")._$$AbstractModule=n._$$ModuleAbstract),n});