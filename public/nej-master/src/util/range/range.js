NEJ.define(["base/global","base/klass","base/element","base/event","base/util","util/event"],function(t,e,_,i,h,s,n,o,a,d,f){return n._$$Range=e._$klass(),f=n._$$Range._$extend(s._$$EventTarget),f.__reset=function(t){this.__super(t),this.__overflow=!!t.overflow,this.__sbody=_._$get(t.sbody),this.__pbody=_._$get(t.pbody)||this.__sbody,this.__parent=_._$get(t.parent)||document.body,this.__doInitDomEvent([[document,"mouseup",this.__onRangEnd._$bind(this)],[document,"mousemove",this.__onRanging._$bind(this)],[this.__parent,"mousedown",this.__onRangeStart._$bind(this)]])},f.__destroy=function(){this.__super(),delete this.__sbody,delete this.__pbody,delete this.__parent,delete this.__offset,delete this.__delta,delete this.__maxbx},f.__doRefreshBox=function(){this.__delta=_._$offset(this.__parent),this.__delta.w=this.__pbody.offsetWidth-this.__sbody.clientWidth,this.__delta.h=this.__pbody.offsetHeight-this.__sbody.clientHeight,this.__maxbx={w:this.__parent.clientWidth,h:this.__parent.clientHeight}},f.__doChangeRange=function(){var t=function(t,e){return!h._$forIn(e,function(e,i){return e!==parseInt(_._$getStyle(t,i))})},e=function(t){return h._$forIn(t,function(t,e,_){_[e]=t+"px"}),t};return function(i){i.top-=this.__delta.y,i.left-=this.__delta.x,i.width=Math.max(0,i.width-this.__delta.w),i.height=Math.max(0,i.height-this.__delta.h);var h={top:i.top,left:i.left},s={width:i.width,height:i.height};if(!this.__overflow){if(i.top<0&&i.left<0)return;h.top=Math.max(0,i.top),h.left=Math.max(0,i.left),i.top>=0?s.height=Math.min(i.height,this.__maxbx.h-h.top-this.__delta.h):delete s.height,i.left>=0?s.width=Math.min(i.width,this.__maxbx.w-h.left-this.__delta.w):delete s.width}t(this.__pbody,h)&&t(this.__sbody,s)||(_._$style(this.__pbody,e(h)),_._$style(this.__sbody,e(s)),this._$dispatchEvent("onchange",this._$getRangeBox()))}}(),f.__onRangeStart=function(t){if(!this.__offset){try{if(t.stopped=!1,this._$dispatchEvent("onbeforechange",t),t.stopped)return}catch(t){}this.__offset={x:i._$pageX(t),y:i._$pageY(t)},this.__doRefreshBox(),this.__doChangeRange({width:0,height:0,event:t,top:this.__offset.y,left:this.__offset.x})}},f.__onRanging=function(t){if(this.__offset){var e={x:i._$pageX(t),y:i._$pageY(t)},_={x:e.x-this.__offset.x,y:e.y-this.__offset.y};this.__doChangeRange({event:t,width:Math.abs(_.x),height:Math.abs(_.y),top:_.y<0?e.y:this.__offset.y,left:_.x<0?e.x:this.__offset.x})}},f.__onRangEnd=function(t){this.__offset&&(delete this.__offset,this._$dispatchEvent("onafterchange"))},f._$getRangeBox=function(){return{width:this.__pbody.offsetWidth,height:this.__pbody.offsetHeight,top:parseInt(_._$getStyle(this.__pbody,"top")),left:parseInt(_._$getStyle(this.__pbody,"left"))}},CMPT&&t.copy(t.P("nej.ut"),n),n});