NEJ.define(["base/element","base/util","util/event"],function(t,i,r,_,s,o,n,l,a){var h,f={};return o._$$ScrollPerf=i._$klass(),h=o._$$ScrollPerf._$extend(s._$$EventTarget),h.__reset=function(t){this.__super(t),this.__level=Math.max(0,Math.min(1,parseInt(t.level)||0)),this.__number=Math.max(0,parseInt(t.offset)||0),this.__viewport=e._$get(t.viewport)||document.body},h.__destroy=function(){this.__super(),delete this.__number,delete this.__viewport,delete this.__scrolltop},h.__doCheckViewPort=function(t){var i=t.t,r=t.b;if(null==i||null==r){var _=e._$offset(t,this.__viewport),i=_.y,r=i+t.offsetHeight;1==this.__level&&(t.t=i,t.b=r)}return r-this.__scrolltop<0?1:i-this.__scrolltop>this.__viewport.clientHeight?-1:0},h.__doParseListInViewPort=function(e,t){if(e&&e.length){var i=u._$binSearch(e,this.__doCheckViewPort._$bind(this));if(!(i<0)){var r,_;t=t||0;for(var s,o=1;s=e[i-o],null!=r||s&&0===this.__doCheckViewPort(s)||(r=i-o-t),s=e[i+o],null!=_||s&&0===this.__doCheckViewPort(s)||(_=i+o+t),null==r||null==_;o++);return[r,_]}}},h.__doPerformImage=function(t){if(!t.finished){for(var i,r,_=!1,s=t.getElementsByTagName("img"),o=0,n=s.length;o<n;o++)r=s[o],i=e._$dataset(r,"src"),i&&(this.__doCheckViewPort(r)?(e._$dataset(r,"src",""),r.src=i):_=!0);_||(t.finished=!0)}},h.__doPerformAppend=function(t){var i=f[t.id];i&&(t.insertAdjacentElement("beforeBegin",i),delete f[t.id],e._$remove(t,!0),t=i),this.__doPerformImage(t),i&&(t.memory=!1,this._$dispatchEvent("onoptimize",t))},h.__doPerformRecycle=function(t){var i=f[t.id];if(!i){var r=u._$randString(8),_=e._$create("div","z-ph js-perf");f[r]=t,_.id=r,_.t=t.t,_.b=t.b,_.innerHTML="&nbsp;",_.style.height=t.offsetHeight+"px",t.insertAdjacentElement("beforeBegin",_),e._$removeByEC(t),t.memory=!0,this._$dispatchEvent("onoptimize",t)}},h._$perfimage=function(t,i){if(this.__scrolltop=t||0,i&&i.length>0)for(var r,_,s=0,o=i.length;s<o;s++)r=i[s],_=e._$dataset(r,"default"),_&&(r.src=_);var i=document.getElementsByTagName("img"),n=this.__doParseListInViewPort(i);if(n){for(var r,_,l=[],s=n[0]+1;s<n[1];s++)r=i[s],_=e._$dataset(r,"src"),_&&_!=r.src&&(r.src=_),l.push(r);return l}},h._$performance=function(t){this.__scrolltop=t||0;var i=e._$getByClassName(this.__viewport,"js-perf"),r=this.__doParseListInViewPort(i,this.__number);if(r)for(var _=0,s=i.length,o=r[0],n=r[1];_<s;_++)_>o&&_<n?this.__doPerformAppend(i[_]):this.__doPerformRecycle(i[_])},h._$getListInViewPort=function(t,i){this.__scrolltop=t||0;var r=e._$getByClassName(this.__viewport,i),_=this.__doParseListInViewPort(r,this.__number);return _?r.slice(_[0]+1,_[1]):null},CMPT&&t.copy(t.P("nej.ut"),o),o});