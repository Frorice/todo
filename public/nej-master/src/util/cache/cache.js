NEJ.define(["base/global","base/klass","base/util","util/event","./storage.js"],function(t,e,a,_,n,c,i,h,s){var r,o="dat-"+ +new Date;return c._$$CacheAbstract=e._$klass(),r=c._$$CacheAbstract._$extend(_._$$EventTarget),r.__init=function(){this.__super(),this.__cache=this.constructor[o],this.__cache||(this.__cache={},this.__cache[o+"-l"]={},this.constructor[o]=this.__cache)},r.__destroy=function(){this.__doClearReqFromQueue(),this.__super()},r.__getDataInCache=function(t){return this.__cache[t]},r.__setDataInCache=function(t,e){this.__cache[t]=e},r.__getDataInCacheWithDefault=function(t,e){var a=this.__getDataInCache(t);return null==a&&(a=e,this.__setDataInCache(t,a)),a},r.__delDataInCache=function(t){return null!=t?void delete this.__cache[t]:void a._$loop(this.__cache,function(t,e){e!=o+"-l"&&this.__delDataInCache(e)},this)},r.__delDataInStorage=function(t){return n._$delDataInStorage(t)},r.__getDataInStorage=function(t){return n._$getDataInStorage(t)},r.__setDataInStorage=function(t,e){n._$setDataInStorage(t,e)},r.__getDataLocalWithDefault=function(t,e){var a=this.__getDataLocal(t);return null==a&&(a=e,this.__setDataLocal(t,a)),a},r.__getDataLocal=function(t){var e=this.__getDataInCache(t);return null!=e?e:(e=this.__getDataInStorage(t),null!=e&&this.__setDataInCache(t,e),e)},r.__setDataLocal=function(t,e){this.__setDataInStorage(t,e),this.__setDataInCache(t,e)},r.__delDataLocal=function(t){return null!=t?(delete this.__cache[t],void n._$delDataInStorage(t)):void a._$loop(this.__cache,function(t,e){e!=o+"-l"&&this.__delDataLocal(e)},this)},r._$clearDataLocal=function(){this.__delDataLocal()},r.__doCallbackRequest=function(t){var e=this.__cache[o+"-l"],_=s.slice.call(arguments,1);a._$forEach(e[t],function(t){try{t.apply(this,_)}catch(t){if(DEBUG)throw t;console.error(t.message),console.error(t.stack)}}),delete e[t]},r.__doQueueRequest=function(t,e){this.__qtmp||(this.__qtmp=[]),this.__qtmp.push({key:t,callback:e}),e=e||h;var a=this.__cache[o+"-l"][t];return a?(a.push(e),!0):(a=[e],this.__cache[o+"-l"][t]=a,!1)},r.__doClearReqFromQueue=function(){a._$forEach(this.__qtmp,function(t){var e=this.__cache[o+"-l"][t.key];a._$reverseEach(e,function(e,a,_){e===t.callback&&_.splice(a)}),e&&e.length||this.__doClearReqQueue(t.key)},this),delete this.__qtmp},r.__doClearReqQueue=function(t){delete this.__cache[o+"-l"][t]},r.__hasFragment=function(t,e,a){if(!t)return!1;if(e=parseInt(e)||0,a=parseInt(a)||0,!a){if(!t.loaded)return!1;a=t.length}t.loaded&&(a=Math.min(a,t.length-e));for(var _=0;_<a;_++)if(void 0===t[e+_])return!1;return!0},r._$isFragmentFilled=function(t,e,a){return this.__hasFragment(this._$getListInCache(t),e,a)},CMPT&&(t.P("nej.ut")._$$Cache=c._$$CacheAbstract),c});