NEJ.define(["base/global","base/klass","base/element","base/util","util/selector/selector"],function(t,e,_,n,s,i,o,h,a){var l;return i._$$RangeSelector=e._$klass(),l=i._$$RangeSelector._$extend(s._$$MultiSelector),l.__reset=function(t){this.__super(t),this.__range=t.range,this.__range&&(this.__range._$setEvent("onchange",this.__onRangeChange._$bind(this)),this.__range._$setEvent("onafterchange",this.__onAfterRangeChange._$bind(this)),this.__doRefreshListPosition())},l.__destroy=function(){var t=function(t){n._$safeDelete(t,["box","last"])};return function(){n._$forEach(this.__list,t),this.__super(),this.__range._$setEvent("onchange",h),delete this.__range}}(),l.__hasInterSection=function(t,e){return Math.max(t.left,e.left)<Math.min(t.left+t.width,e.left+e.width)&&Math.max(t.top,e.top)<Math.min(t.top+t.height,e.top+e.height)},l.__doRefreshListPosition=function(){var t=function(t){var e=_._$offset(t);t.box={top:e.y,left:e.x,width:t.offsetWidth,height:t.offsetHeight}};return function(){n._$forEach(this.__list,t)}}(),l.__doRefreshItemSelect=function(t,e){var _=e.flag,n=t.ctrlKey,s=t.shiftKey,i=this.__hasInterSection(e.box,t),o=this.__isItemSelected(_);null==e.last&&(e.last=o),i?(n&&e.last?this.__doItemDelFromSelection(_,e):this.__doItemAddToSelection(_,e),!n&&s&&(e.last=!1)):e.last?this.__doItemAddToSelection(_,e):this.__doItemDelFromSelection(_,e)},l.__doAdjustLastItem=function(t){n._$safeDelete(t,"last");var e=t.flag;this.__last<0&&this.__isItemSelected(e)&&(this.__last=e)},l.__onRangeChange=function(t){t.ctrlKey=t.event.ctrlKey,t.shiftKey=t.event.shiftKey,delete t.event,window.setTimeout(n._$forEach._$bind(n,this.__list,this.__doRefreshItemSelect._$bind(this,t)),0)},l.__onAfterRangeChange=function(){n._$forEach(this.__list,this.__doAdjustLastItem,this)},CMPT&&t.copy(t.P("nej.ut"),i),i});