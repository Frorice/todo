NEJ.define(["base/global","base/klass","base/util","util/event"],function(t,i,_,s,e,n,h,a){var d;return e._$$PlayList=i._$klass(),d=e._$$PlayList._$extend(s._$$EventTarget),d.__reset=function(t){this.__super(t),this._$setPlayMode(t.mode),this._$setPlayList(t.list)},d.__destroy=function(){this.__super(),delete this.__index,delete this.__list,delete this.__mode,delete this.__rlist},d.__doGenRandList=function(){var t=function(t,i){return null==t?i:t};return function(){if(!this.__list||!this.__list.length)return void(this.__rlist=[]);for(var i,_=[0],s=this.__list.length;s>1;)i=Math.floor(Math.random()*s),s--,s!==i?(_tmp=t(_[s],s),_[s]=t(_[i],i),_[i]=_tmp):_[s]=t(_[s],s);this.__rlist=_}}(),d._$setPlayMode=function(t){if(t=parseInt(t)||0,(t<0||t>2)&&(t=0),t!==this.__mode){var i={mode:t,last:this.__mode};this.__mode=t,2==this.__mode?this.__doGenRandList():delete this.__rlist,this._$dispatchEvent("onmodechange",i)}},d._$getPlayMode=function(){return this.__mode},d._$setPlayList=function(t){_._$isArray(t)||(t=[]),this.__list=t,2==this.__mode?(this.__doGenRandList(),this.__index=this.__rlist[0]):this.__index=0,this._$play()},d._$getPlayList=function(){return this.__list},d._$setPlayIndex=function(t){var i=this.__list.length;t=parseInt(t);var _=t,s=this.__index;t<0||t>=i?_=-1:this.__index=t;var e={last:s,index:_,list:this.__list};this._$dispatchEvent("onmediachange",e)},d._$getPlayIndex=function(){return this.__index},d._$appendMedia=function(t){var i={data:t,list:this.__list,index:this.__index};this._$dispatchEvent("onbeforeappend",i),t=i.data,t&&(this.__list.push(t),2==this.__mode&&this.__doGenRandList()),this._$dispatchEvent("onafterappend",i)},d._$removeMedia=function(t){var i=this.__list.length;t<0||t>=_legnth||(this.__list.splice(t,1),2==this.__mode&&this.__doGenRandList(),t==this.__index&&(this.__index>=i&&(this.__index=i-1),this._$play()))},d._$play=function(){var t=function(t){var i=this.__list.length,_=(this.__index+t)%i;return _<0?i+_:_},i=function(t){var i=this.__list.length,s=_._$indexOf(this.__rlist,this.__index);return s=(s+t)%i,s=s<0?i+s:s,this.__rlist[s]},s=[t,t,i];return function(t){t=parseInt(t)||0,this._$setPlayIndex((s[this.__mode]||h).call(this,t)||0)}}(),d._$autoNext=function(){1==this.__mode?this._$setPlayIndex(this._$getPlayIndex()):this._$next()},d._$next=function(){this._$play(1)},d._$prev=function(){this._$play(-1)},CMPT&&t.copy(t.P("nej,ut"),e),e});