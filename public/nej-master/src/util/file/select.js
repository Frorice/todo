NEJ.define(["base/global","base/element","base/event","base/util","{platform}select.js","base/chain"],function(e,t,n,a,i,r,l,d,u,o){var c={},p=t._$pushCSSText(".#<uispace>{position:absolute;width:0;height:0;overflow:hidden;}");if(l._$bind=function(){var e=function(e){var t=c[e];return t||(t={},c[e]=t),t},r=function(e,t){if(t){var n=[];a._$loop(t,function(e,t){n.push('<input type="hidden" name="'+t+'" value="'+e+'">')}),e.insertAdjacentHTML("afterBegin",n.join(""))}},l=function(e,n,a,i,l){var d,u=c[e],o=p+" "+(a||"");n=t._$get(n),n?(d=t._$create("div",o),n.appendChild(d),t._$dataset(n,"id",e),r(n,i)):(d=t._$create("form",o),t._$dataset(d,"id",e),r(d,i),(l||document.body).appendChild(d)),u.pid=t._$id(d)},o=function(e,a){var i=a.accept||"";i&&(i='accept="'+i+'"');var r="";a.multiple&&(r='multiple="true"');var a=c[e],l=e+"-"+a.nmb,d=t._$html2node('<input type="file" '+r+" "+i+' contenteditable="false" id="'+l+'"/>');return a.nmb++,t._$get(a.pid).appendChild(d),n._$addEvent(d,"change",f),l},f=function(e){var a=n._$getElement(e),i=a.id,r=i.split("-"),l=c[r[0]];if(a.value){if(l.multiple&&(t._$get(l.lab).htmlFor=o(r[0],l)),!a.name){var d="";a.name=l.name+d}l.onchange({id:i,form:a.form,target:t._$get(l.lab)})}};return function(n,r){if(n=t._$get(n),n&&"LABEL"==n.tagName){t._$dumpCSSText();var c=a._$uniqueID(),p=e(c);return r=r||d,l(c,r.form,r.clazz,r.param,t._$get(r.parent)),p.nmb=0,p.name=r.name||"file",p.lab=t._$id(n),p.accept=r.accept||"",p.multiple=!!r.multiple,p.onchange=r.onchange||u,n.htmlFor=o(c,p),i.__handleFileLabelClick(n),c}}}(),l._$get=function(e){var n=c[e];if(n){var a=t._$get(n.pid);if(a)return"FORM"!=a.tagName&&(a=a.parentNode),a}},l._$unbind=function(e){var t=c[e];if(t){var n=l._$get(e);return delete c[e],{form:n,parent:t.pid}}},l._$selectable=function(){var e;return function(){if(null==e){var t=document.createElement("input");t.type="file",e=!t.disabled}return e}}(),r._$merge({_$bind:l._$bind}),CMPT){var r=e.P("nej.e");r._$file=l._$bind,r._$getFileForm=l._$get,r._$removeFileForm=l._$unbind}return l});