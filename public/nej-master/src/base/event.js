NEJ.define(["./global.js","./element.js","./util.js","./chain.js","{platform}event.js"],function(n,e,t,r,u,o,a,l,c){var _={},i={},f=function(){var n=/[\s,;]+/;return function(e){var e=(e||"").trim().toLowerCase();return e?e.split(n):null}}(),p=function(n,t,r){var u="page"+t;return null!=n[u]?n[u]:n["client"+t]+e._$getPageBox()["scroll"+r]},d=function(n,e,t){var r="scroll"+t;for(_node=o._$getElement(n),_xret=p(n,e,t);_node&&_node!=document.body&&_node!=document.documentElement;)_xret+=_node[r]||0,_node=_node.parentNode;return _xret},$=function(n,r,u,o){var a={};if(n=e._$get(n),!n)return null;if(e._$id(n),a.element=n,!t._$isFunction(u))return null;a.handler=u;var r=f(r);return r?(a.type=r,a.capture=!!o,a):null};return o._$addEvent=i._$addEvent=function(){var n=function(n,t,r){var u=e._$id(t.element),o=_[u]||{},a=o[n]||[];a.push({type:r.type||n,func:r.handler||t.handler,sfun:t.handler,capt:t.capture,link:r.link,destroy:r.destroy}),o[n]=a,_[u]=o};return function(){var r=$.apply(null,arguments);r&&t._$forEach(r.type,function(o){var a=u.__checkEvent(r.element,o,r.handler);u.__addEvent(r.element,a.type,a.handler,r.capture),t._$forIn(a.link,function(n){n[3]=!!n[3],u.__addEvent.apply(u,n),n[0]=e._$id(n[0])}),n(o,r,a)})}}(),o._$delEvent=i._$delEvent=function(){var n=function(n,r){var u=e._$id(r.element),o=_[u]||a,l=o[n],c=t._$indexOf(l,function(n){return n.sfun===r.handler&&n.capt===r.capture}),i=null;if(c>=0){var f=l.splice(c,1)[0];i=[[r.element,f.type,f.func,r.capture]],f.link&&(t._$forEach(f.link,function(n){n[0]=e._$get(n[0])}),i.push.apply(i,f.link)),f.destroy&&f.destroy(),l.length||delete o[n],t._$hasProperty(o)||delete _[u]}return i};return function(){var e=$.apply(null,arguments);e&&t._$forEach(e.type,function(r){t._$forEach(n(r,e),function(n){u.__delEvent.apply(u,n)})})}}(),o._$clearEvent=i._$clearEvent=function(){var n=function(n,e,r){t._$reverseEach(r,function(t){o._$delEvent(n,e,t.sfun,t.capt)})};return function(r,u){var a=e._$id(r);if(a){var l=_[a];l&&(u=f(u),u?t._$forEach(u,function(e){n(a,e,l[e])}):t._$loop(l,function(n,e){o._$clearEvent(r,e)}))}}}(),o._$dispatchEvent=i._$dispatchEvent=function(n,r,o){var n=e._$get(n);n&&t._$forEach(f(r),function(e){var t=u.__checkEvent(n,e);u.__dispatchEvent(n,t.type,o)})},o._$getElement=function(n){if(!n)return null;var t=n.target||n.srcElement,r=arguments[1];return e._$getParent(t,r)},o._$stop=function(n){o._$stopBubble(n),o._$stopDefault(n)},o._$stopBubble=function(n){n&&(n.stopPropagation?n.stopPropagation():n.cancelBubble=!0)},o._$stopDefault=function(n){n&&(n.preventDefault?n.preventDefault():n.returnValue=!1)},o._$page=function(n){return{x:o._$pageX(n),y:o._$pageY(n)}},o._$pageX=function(n){return d(n,"X","Left")},o._$pageY=function(n){return d(n,"Y","Top")},o._$clientX=function(n){return p(n,"X","Left")},o._$clientY=function(n){return p(n,"Y","Top")},r._$merge(i),CMPT&&n.copy(n.P("nej.v"),o),o});