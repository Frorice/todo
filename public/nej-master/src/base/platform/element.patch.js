NEJ.define(["./element.js","base/platform","base/util"],function(e,t,n,r,i,a,o){return NEJ.patch("TR",function(){e.__getChildren=e.__getChildren._$aop(function(e){var t=e.args[0];if(!t.children){e.stopped=!0;var r=[];n._$forEach(t.childNodes,function(e){1==e.nodeType&&r.push(e)}),e.value=r}})}),NEJ.patch("TR<=6.0",function(){e.__dataset=function(){var e={},t="data-",r=/\-(.{1})/gi,i=function(i){var a=i.id;if(!e[a]){var o={};n._$forEach(i.attributes,function(e){var n=e.nodeName;0==n.indexOf(t)&&(n=n.replace(t,"").replace(r,function(e,t){return t.toUpperCase()}),o[n]=e.nodeValue||"")}),e[a]=o}};return function(t,n,r){i(t);var a=e[t.id];return void 0!==r&&(a[n]=r),a[n]}}()}),NEJ.patch("TR<=5.0",function(){try{document.execCommand("BackgroundImageCache",!1,!0)}catch(e){}e.__injectCSSText=function(){var t=30;return e.__injectCSSText._$aop(function(e){var n=e.args[0];if(n.styleSheet){e.stopped=!0;var r=e.args[1],i=document.styleSheets;i.length>t?(n=i[t],r=n.cssText+r):n=n.styleSheet,n.cssText=r}})}(),e.__getClassRegExp=function(){var e=/\s+/g;return function(t){return t=(t||"").trim().replace(e,"|"),t?new RegExp("(\\s|^)(?:"+t+")(?=\\s|$)","g"):null}}(),e.__processClassName=function(t,n,r){r=r||"";var i=t.className||"",a=e.__getClassRegExp(r+" "+(arguments[3]||"")),o=i;switch(a&&(o=o.replace(a,"")),n){case"remove":r="";break;case"replace":r=arguments[3]||""}o=(o+" "+r).trim(),i!=o&&(t.className=o)},e.__hasClassName=function(t,n){var r=e.__getClassRegExp(n);return!!r&&r.test(t.className||"")}}),NEJ.patch("TR<=4.0",function(){e.__getElementsByClassName=function(e,t){var r=[],i=new RegExp("(\\s|^)(?:"+t.replace(/\s+/g,"|")+")(?=\\s|$)");return n._$forEach(e.getElementsByTagName("*"),function(e){i.test(e.className)&&r.push(e)}),r},e.__nextSibling=function(e){for(;e=e.nextSibling;)if(1==e.nodeType)return e},e.__previousSibling=function(e){for(;e=e.previousSibling;)if(1==e.nodeType)return e},e.__serializeDOM2XML=function(e){return"xml"in e?e.xml:e.outerHTML},e.__parseDOMFromXML=function(){var e=["Msxml2.DOMDocument.6.0","Msxml2.DOMDocument.3.0"],t=function(){try{for(var t=0,n=e.length;t<n;t++)return new ActiveXObject(e[t])}catch(e){return null}};return function(e){var n=t();return n&&n.loadXML(e)&&!n.parseError.errorCode?n.documentElement:null}}(),e.__getStyleValue=function(){var t=/opacity\s*=\s*([\d]+)/i,n={opacity:function(e){var n=0;return t.test(e.filter||"")&&(n=parseFloat(RegExp.$1)/100),n}};return function(t,r){var i=t.currentStyle,a=n[r];return a?a(i):i[e.__getStyleName(r)]||""}}(),e.__setStyleValue=function(){var t={opacity:function(e,t){e.style.filter="alpha(opacity="+100*t+")"}};return function(n,r,i){var a=t[r];a?a(n,i):n.style[e.__getStyleName(r)]=i}}(),e.__appendCSSText=function(e,t){var n=e.styleSheet,r=n.rules.length,i=t.split(/[\{\}]/);return n.addRule(i[0],i[1],r),n.rules[r]}}),NEJ.patch("TR<=3.0",function(){e.__getAttribute=e.__getAttribute._$aop(null,function(e){var t=e.args;"maxlength"==t[1]&&2147483647==e.value&&(e.value=null)})}),NEJ.patch("TR<=2.0",function(){e.__fullScreen=function(e,t){var n=e.style;n.width=t.scrollWidth+"px",n.height=t.scrollHeight+"px"},e.__mask=function(){var t={};return e.__unmask=function(e){var n=e.id,r=t[n];r&&(delete t[n],r.parentNode.removeChild(r))},function(e){var n=e.id,r=t[n];r||(r=document.createElement("iframe"),r.style.position="absolute",t[n]=r);var i=r.style,a=e.style;return i.top=(parseInt(a.top)||0)+"px",i.left=(parseInt(a.left)||0)+"px",i.width=e.offsetWidth+"px",i.height=e.offsetHeight+"px",e.insertAdjacentElement("beforeBegin",r),r}}()}),NEJ.patch("GR",function(){t._$SUPPORT.css3d||(t._$SUPPORT.css3d="MozPerspective"in document.body.style),"insertAdjacentElement"in document.body||(HTMLElement.prototype.insertAdjacentElement=function(e,t){if(e&&t)switch(e){case"beforeEnd":return void this.appendChild(t);case"beforeBegin":return void this.parentNode.insertBefore(t,this);case"afterBegin":return void(this.firstChild?this.insertBefore(t,this.firstChild):this.appendChild(t));case"afterEnd":return void(this.nextSibling?this.parentNode.insertBefore(t,this.nextSibling):this.parentNode.appendChild(t))}}),"innerText"in document.body||(HTMLElement.prototype.__defineGetter__("innerText",function(){return this.textContent}),HTMLElement.prototype.__defineSetter__("innerText",function(e){this.textContent=e}))}),e});