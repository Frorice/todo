NEJ.define(["./global.js","./constant.js","./util.js","./event.js","./chain.js","{platform}element.js"],function(e,t,n,r,i,o,a,u,c,l){var _,s={},f={},d={},$=document.createDocumentFragment();return document.head||(document.head=document.getElementsByTagName("head")[0]||document.body),a.dump=function(){return{pool:f,dirty:d,fragment:$}},a._$id=s._$id=function(e){if(e=a._$get(e)){var t=e.id?e.id:"auto-id-"+n._$uniqueID();return"id"in e||(f[t]=e),e.id=t,a._$get(t)||(d[t]=e),t}},a._$get=function(e){try{var t=f[""+e]}catch(e){}if(t)return t;if(!n._$isString(e)&&!n._$isNumber(e))return e;var t=document.getElementById(e);return t||(t=o.__getElementById($,e)),t&&delete d[e],t||d[e]},a._$getChildren=s._$getChildren=function(e,t){if(e=a._$get(e),!e)return null;var r=o.__getChildren(e);return t&&n._$reverseEach(r,function(e,n,r){a._$hasClassName(e,t)||r.splice(n,1)}),r},a._$getParent=function(){var e,t=function(t,n){var r=t.split(":");if(r.length>1){e||(e={a:a._$attr,d:a._$dataset,c:a._$hasClassName,t:function(e,t){return(e.tagName||"").toLowerCase()===t}});var i=e[r[0]];if(i)return!!i(n,r[1]);t=r[1]}return!!a._$attr(n,t)||!!a._$dataset(n,t)||a._$hasClassName(n,t)};return function(e,r){if(e=a._$get(e)){if(!r)return e;if(n._$isString(r)&&(r=t._$bind(null,r)),n._$isFunction(r)){for(;e;){if(r(e))return e;e=e.parentNode}return null}return e}}}(),a._$getByClassName=s._$getByClassName=function(e,t){return e=a._$get(e),e?o.__getElementsByClassName(e,t.trim()):null},a._$getSibling=s._$getSibling=function(){var e=function(){return!0};return function(t,r){if(t=a._$get(t),!t)return null;var i={backward:!1,filter:e};n._$isFunction(r)?i.filter=r:i=n._$fetch(i,r);for(var u=i.backward?o.__previousSibling:o.__nextSibling;(t=u(t))&&!i.filter(t););return t}}(),a._$getScrollViewPort=function(e){if(e=a._$get(e)){for(e=e.parentNode;e&&!(e.scrollHeight>e.clientHeight);)e=e.parentNode;if(e)return e}var t=document.body.scrollHeight,n=document.documentElement.scrollHeight;return n>=t?document.documentElement:document.body},a._$getPageBox=function(){var e=function(e){var t=0;return n._$forEach(e,function(e){e&&(t=t?Math.min(t,e):e)}),t},t=[{main:"scroll",sub:["Top","Left"],func:function(e,t,n){return Math.max(t["scroll"+e],n["scroll"+e])}},{main:"client",sub:["Width","Height"],func:function(t,n,r){return e([n["client"+t],n["offset"+t],r["client"+t],r["offset"+t]])}},{main:"scroll",sub:["Width","Height"],func:function(e,t,n,r){return Math.max(r["client"+e],t["scroll"+e],n["scroll"+e])}}];return function(e){var r={},i=e||document,o=i.body,a=i.documentElement;return n._$forEach(t,function(e){var t=e.main;n._$forEach(e.sub,function(n){r[t+n]=e.func(n,o,a,r)})}),r}}(),a._$getMaxBox=function(e,t){var r=n._$merge({},e),i=t.width/t.height,o=e.width/e.height;return i>o&&e.height>t.height&&(r.height=t.height,r.width=r.height*o),i<o&&e.width>t.width&&(r.width=t.width,r.height=r.width/o),r},a._$scrollTo=s._$scrollTo=function(e){var t=a._$offset(e);window.scrollTo(t.x,t.y)},a._$align=function(){var e=/\s+/,t={left:function(){return 0},center:function(e,t){return(e.width-t.width)/2},right:function(e,t){return e.width-t.width},top:function(){return 0},middle:function(e,t){return(e.height-t.height)/2},bottom:function(e,t){return e.height-t.height}};return function(n,r,i){var o={},a=(i||"").split(e),u=t[a[1]]||t.middle,c=t[a[0]]||t.center;return o.top=u(n,r),o.left=c(n,r),o}}(),a._$offset=s._$offset=function(){var e=function(e){return e==document.body||e==document.documentElement};return function(t,n){if(t=a._$get(t),!t)return null;n=a._$get(n)||null;for(var r,i,o,u=t,c={x:0,y:0};u&&u!=n;)r=e(u)||u==t,i=r?0:u.scrollLeft,o=parseInt(a._$getStyle(u,"borderLeftWidth"))||0,c.x+=u.offsetLeft+o-i,i=r?0:u.scrollTop,o=parseInt(a._$getStyle(u,"borderTopWidth"))||0,c.y+=u.offsetTop+o-i,u=u.offsetParent;return c}}(),a._$fullScreen=s._$fullScreen=function(e){e=a._$get(e),e&&o.__fullScreen(e,a._$getPageBox())},a._$mask=s._$mask=function(e){return e=a._$get(e),e?(a._$id(e),o.__mask(e)):null},a._$unmask=s._$unmask=function(e){return e=a._$get(e),e?(a._$id(e),o.__unmask(e)):null},a._$create=function(){var e={a:{href:"#",hideFocus:!0},style:{type:"text/css"},link:{type:"text/css",rel:"stylesheet"},iframe:{frameBorder:0},script:{defer:!0,type:"text/javascript"}};return function(t,r,i){var o=document.createElement(t),u=e[t.toLowerCase()];return n._$merge(o,u),r&&(o.className=r),i=a._$get(i),i?i.appendChild(o):u||$.appendChild(o),o}}(),a._$createXFrame=function(){var e=function(){return location.hostname==document.domain?"about:blank":'javascript:(function(){document.open();document.domain="'+document.domain+'";document.close();})();'},t=function(e){if(e=e.trim(),!e)return a._$create("iframe");var t;try{t=document.createElement('<iframe name="'+e+'"></iframe>'),t.frameBorder=0}catch(n){t=a._$create("iframe"),t.name=e}return t};return function(i){i=i||u;var o=t(i.name||"");i.visible||(o.style.display="none"),n._$isFunction(i.onload)&&r._$addEvent(o,"load",function(e){o.src&&(r._$clearEvent(o,"load"),i.onload(e))});var c=i.parent;if(n._$isFunction(c))try{c(o)}catch(e){}else(a._$get(c)||document.body).appendChild(o);var l=i.src||e();return window.setTimeout(function(){o.src=l},0),o}}(),a._$remove=s._$remove=function(){var e={img:function(e){e.src=t._$BLANK_IMAGE},iframe:function(e){e.src="about:blank"}},i=function(t,r){if(!r){var o=(t.tagName||"").toLowerCase(),a=e[o];return void(a&&a(t))}t.getElementsByTagName&&n._$forEach(t.getElementsByTagName(r),i)};return function(e){e=a._$get(e),e&&(arguments[1]||r._$clearEvent(e),i(e),i(e,"img"),i(e,"iframe"),e.parentNode&&e.parentNode.removeChild(e))}}(),a._$removeByEC=s._$removeByEC=function(e){if(e=a._$get(e))try{$.appendChild(e)}catch(e){console.error(e)}},a._$clearChildren=s._$clearChildren=function(e){e=a._$get(e),e&&n._$reverseEach(e.childNodes,function(e){a._$remove(e)})},a._$wrapInline=s._$wrapInline=function(){var e,t=/\s+/,n=function(){e||(e=a._$pushCSSText(".#<uispace>{position:relative;zoom:1;}.#<uispace>-show{position:absolute;top:0;left:100%;cursor:text;white-space:nowrap;overflow:hidden;}"),a._$dumpCSSText())};return function(r,i){if(r=a._$get(r),!r)return null;n(),i=i||u;var o=r.parentNode;a._$hasClassName(o,e)||(o=a._$create("span",e),r.insertAdjacentElement("beforeBegin",o),o.appendChild(r));var c=i.nid||"",l=a._$getByClassName(o,c||e+"-show")[0];if(!l){var _=((i.clazz||"")+" "+c).trim();_=e+"-show"+(_?" ":"")+_,l=a._$create(i.tag||"span",_),o.appendChild(l)}var _=i.clazz;return _&&(_=(_||"").trim().split(t)[0]+"-parent",a._$addClassName(o,_)),l}}(),a._$dataset=s._$dataset=function(e,t,r){var i=a._$id(e);if(!i)return null;if(n._$isString(t))return o.__dataset(a._$get(e),t,r);if(n._$isObject(t)){var u={};return n._$forIn(t,function(e,t){u[t]=a._$dataset(i,t,e)}),u}if(n._$isArray(t)){var u={};return n._$forEach(t,function(e){u[e]=a._$dataset(i,e)}),u}return null},a._$attr=s._$attr=function(e,t,n){return(e=a._$get(e))?(void 0!==n&&e.setAttribute&&e.setAttribute(t,n),o.__getAttribute(e,t)):""},a._$html2node=function(){var e=/<(.*?)(?=\s|>)/i,t={li:"ul",tr:"tbody",td:"tr",th:"tr",option:"select"};return function(n){var r;e.test(n)&&(r=t[(RegExp.$1||"").toLowerCase()]||"");var i=a._$create(r||"div");i.innerHTML=n;var o=a._$getChildren(i);return o.length>1?i:o[0]}}(),a._$dom2xml=s._$dom2xml=function(e){return e=a._$get(e),e?o.__serializeDOM2XML(e):""},a._$xml2dom=function(e){return e=(e||"").trim(),e?o.__parseDOMFromXML(e):null},a._$dom2object=s._$dom2object=function(e,t){if(t=t||{},e=a._$get(e),!e)return t;var r=e.tagName.toLowerCase(),i=a._$getChildren(e);if(!i||!i.length)return t[r]=e.textContent||e.text||"",t;var o={};return t[r]=o,n._$forEach(i,function(e){a._$dom2object(e,o)}),t},a._$xml2object=function(e){try{return a._$dom2object(a._$xml2dom(e))}catch(e){return null}},a._$text2type=function(){var e={xml:function(e){return a._$xml2dom(e)},json:function(e){try{return JSON.parse(e)}catch(e){return null}},dft:function(e){return e}};return function(t,n){return n=(n||"").toLowerCase(),(e[n]||e.dft)(t||"")}}(),a._$style=s._$style=function(e,t){e=a._$get(e),e&&n._$loop(t,function(t,n){a._$setStyle(e,n,t)})},a._$setStyle=s._$setStyle=function(e,t,n){e=a._$get(e),e&&o.__setStyleValue(e,t,o.__processCSSText(n))},a._$getStyle=s._$getStyle=function(e,t){return e=a._$get(e),e?o.__getStyleValue(e,t):""},a._$addScript=function(e){try{if(e=e.trim())return new Function(e)()}catch(e){console.error(e.message),console.error(e.stack)}},a._$addStyle=function(){var e=/[\s\r\n]+/gi;return function(t){t=(t||"").replace(e," ").trim();var n=null;return t&&(n=a._$create("style"),document.head.appendChild(n),o.__injectCSSText(n,o.__processCSSText(t))),n}}(),a._$pushCSSText=function(){var e=/#<(.*?)>/g;+new Date;return function(t,r){_||(_=[]);var i="auto-"+n._$uniqueID(),o=n._$merge({uispace:i},r);return _.push(t.replace(e,function(e,t){return o[t]||e})),i}}(),a._$dumpCSSText=function(){_&&(a._$addStyle(_.join(" ")),_=null)},a._$appendCSSText=s._$appendCSSText=function(e,t){return e=a._$get(e),e?o.__appendCSSText(e,o.__processCSSText(t)):null},a._$addClassName=s._$addClassName=function(e,t){t&&(e=a._$get(e),e&&o.__processClassName(e,"add",t))},a._$delClassName=s._$delClassName=function(e,t){e=a._$get(e),e&&o.__processClassName(e,"remove",t)},a._$replaceClassName=s._$replaceClassName=function(e,t,n){e=a._$get(e),e&&o.__processClassName(e,"replace",t,n)},a._$hasClassName=s._$hasClassName=function(e,t){return e=a._$get(e),!!e&&o.__hasClassName(e,t)},a._$matrix=function(e){return e=(e||"").trim(),o.__getCSSMatrix(e)},a._$css3d=s._$css3d=function(e,t,n){if(e=a._$get(e)){var r=o.__processTransformValue(t,n);r&&a._$setStyle(e,"transform",r)}},i._$merge(s),CMPT&&e.copy(e.P("nej.e"),a),a});